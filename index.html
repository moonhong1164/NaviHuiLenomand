<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>NAVI&HUI LENORMAND</title>
<style>
:root{
  --bg:#efe7ff;           /* ì—°ë³´ë¼ ë°°ê²½ */
  --panel:#f7f3ff;
  --card:#ffffff;
  --ink:#2a2240;
  --muted:#6c6290;
  --ring:#d6c9ff;
  --shadow:0 10px 28px rgba(84,64,140,.18);
  --card-w: 210px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,Segoe UI,Apple SD Gothic Neo,pretendard,sans-serif}
header{position:sticky;top:0;z-index:10;background:linear-gradient(180deg,#efe7ffcc,#efe7ff80 80%,transparent);backdrop-filter:blur(6px)}
.container{max-width:1100px;margin:0 auto;padding:14px 16px}
h1{margin:4px 0 10px;font-size:28px;letter-spacing:.3px}

.controls{display:flex;flex-wrap:wrap;gap:10px;padding:14px;border:1px solid var(--ring);background:var(--panel);border-radius:16px;box-shadow:var(--shadow)}
.btn{display:inline-flex;align-items:center;gap:8px;padding:9px 14px;border:1px solid var(--ring);background:#fff;border-radius:12px;cursor:pointer}
.badge{display:inline-flex;align-items:center;gap:6px;padding:2px 10px;border-radius:999px;background:#fff;border:1px solid var(--ring);color:var(--muted);font-size:13px}
input[type="search"]{padding:10px 12px;border:1px solid var(--ring);border-radius:12px;background:#fff}

.stage{margin:14px 0}
.draw-result{display:grid;gap:12px}
.card-mini{width:var(--card-w);background:var(--card);border:1px solid var(--ring);border-radius:16px;box-shadow:var(--shadow);padding:10px}
.card-mini .img{width:100%;aspect-ratio:3/4;border-radius:12px;background:#e8defc;display:flex;align-items:center;justify-content:center;overflow:hidden}
.card-mini .img img{width:100%;height:100%;object-fit:contain;display:block}
.card-mini h4{margin:8px 6px 6px;font-size:18px}
.card-mini p{margin:6px}

.row{display:flex;gap:6px;flex-wrap:wrap}
.chip{font-size:12px;color:var(--muted);padding:2px 8px;border-radius:999px;background:#faf8ff;border:1px solid var(--ring)}

/* ê²°ê³¼ í†¤ í‘œì‹œ */
.tone{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:12px;background:#fff;border:1px solid var(--ring);box-shadow:var(--shadow)}
.t-pos{color:#0a47ff}
.t-neg{color:#d10a0a}
.t-neu{color:#0a8a3a}

/* 5ì¹´ë“œ ê°€ë¡œ ê³ ì • */
.draw-5{grid-template-columns:repeat(5,var(--card-w));justify-content:center}
@media (max-width:700px){ .draw-5{grid-template-columns:repeat(5,var(--card-w));} }

/* ì‹­ì ìŠ¤í”„ë ˆë“œ (ì¤‘ì•™+ìƒí•˜ì¢Œìš°) */
.cross-wrap{border:1px solid var(--ring);border-radius:16px;background:var(--panel);padding:10px;box-shadow:var(--shadow)}
.cross-box{position:relative;width:100%;overflow:hidden}
.cross-stage{display:inline-block;transform-origin:top left}
.cross-grid{display:grid;grid-template-columns:repeat(3,var(--card-w));grid-auto-rows:auto;gap:10px;width:max-content}
.cross-grid .spacer{width:var(--card-w);height:10px}
.cross-grid .c{}

/* ê·¸ë‘íƒ€ë¸”ë¡œ ê³µí†µ (9x4, 8x4+4) */
.gt-wrap{border:1px solid var(--ring);border-radius:16px;background:var(--panel);padding:10px;box-shadow:var(--shadow)}
.gt-toolbar{margin:6px 2px 10px;color:var(--muted)}
.gt-scroll{position:relative;width:100%;overflow:hidden;-webkit-overflow-scrolling:touch}
.gt-stage{display:inline-block;transform-origin:top left}
.gt-grid{display:inline-grid;width:max-content;gap:8px;justify-content:start}
.gt-card{width:var(--card-w)}
.sidepanel{margin-top:10px;padding:10px 12px;border-radius:12px;background:#fff;border:1px solid var(--ring);box-shadow:var(--shadow);color:#493d71}

/* ì¹´ë“œ ì „ì²´ ë³´ê¸° */
.gallery-toggle{margin:14px 0 6px}
.grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fill,minmax(180px,1fr))}
.gcard{background:#fff;border:1px solid var(--ring);border-radius:16px;box-shadow:var(--shadow);padding:10px}
.gcard .img{width:100%;aspect-ratio:3/4;background:#e8defc;border-radius:12px;overflow:hidden}
.gcard .img img{width:100%;height:100%;object-fit:contain}

footer{padding:28px 16px;color:#8a7fb0;text-align:center}
</style>
</head>
<body>
<header><div class="container"><h1>NAVI&HUI LENORMAND</h1></div></header>

<main class="container">
  <section class="controls">
    <label class="badge"><input id="qToggle" type="checkbox"> ì§ˆë¬¸ ì…ë ¥</label>
    <input id="qInput" type="search" placeholder="ì§ˆë¬¸(ì„ íƒ)" style="display:none">
    <button class="btn" id="btn1">ğŸƒ 1ì¹´ë“œ</button>
    <button class="btn" id="btn3">ğŸƒğŸƒğŸƒ 3ì¹´ë“œ</button>
    <button class="btn" id="btn5">ğŸƒğŸƒğŸƒğŸƒğŸƒ 5ì¹´ë“œ</button>
    <button class="btn" id="btnCross">â• ì‹­ì</button>
    <button class="btn" id="btn9x4">ğŸ§© 9Ã—4</button>
    <button class="btn" id="btn8x4p4">ğŸ§© 8Ã—4+4</button>
  </section>

  <section id="questionBox" class="tone t-neu" style="display:none;margin-top:10px;">ì§ˆë¬¸:</section>

  <section class="stage">
    <div id="draw" class="draw-result"></div>
    <div id="summary" class="tone" style="display:none;margin-top:12px"></div>
  </section>

  <div class="gallery-toggle">
    <button class="btn" id="toggleAll">ğŸ“ ì¹´ë“œ ì „ì²´ ë³´ê¸°</button>
    <input id="filter" type="search" placeholder="ì¹´ë“œ ê²€ìƒ‰ (ë²ˆí˜¸/ì´ë¦„)">
  </div>
  <div id="gallery" class="grid" style="display:none"></div>
</main>

<footer>Â© NAVI & HUI</footer>

<script>
/* ---------- ë°ì´í„°(ìš”ì•½) ---------- */
const CARDS = [
  {n:1,  code:'Rider', kr:'ê¸°ìˆ˜',   key:'ì†Œì‹Â·ë„ì°©Â·ë¹ ë¥¸ ì§„í–‰', type:'positive'},
  {n:2,  code:'Clover', kr:'í´ë¡œë²„', key:'ê¸°íšŒÂ·í–‰ìš´Â·ì§§ì€ í˜¸ì¬', type:'positive'},
  {n:3,  code:'Ship', kr:'ì„ ë°•', key:'ì—¬í–‰Â·í™•ì¥Â·ì´ë™', type:'positive'},
  {n:4,  code:'House', kr:'ì§‘', key:'ì•ˆì •Â·ê°€ì •Â·ê¸°ë°˜', type:'positive'},
  {n:5,  code:'Tree', kr:'ë‚˜ë¬´', key:'ê±´ê°•Â·ì„±ì¥Â·ë¿Œë¦¬', type:'neutral'},
  {n:6,  code:'Cloud', kr:'êµ¬ë¦„', key:'í˜¼ë€Â·ë¶ˆí™•ì‹¤Â·íŒë‹¨ë³´ë¥˜', type:'negative'},
  {n:7,  code:'Snake', kr:'ë±€', key:'ìœ í˜¹Â·ì¥ì• Â·ìš°íšŒ', type:'negative'},
  {n:8,  code:'Coffin', kr:'ê´€', key:'ëÂ·ì „í™˜Â·ì •ë¦¬', type:'negative'},
  {n:9,  code:'Bouquet', kr:'ë¶€ì¼€', key:'ê¸°ì¨Â·ì„ ë¬¼Â·í˜¸ì˜', type:'positive'},
  {n:10, code:'Scythe', kr:'ë‚«', key:'ë‹¨ì ˆÂ·ê²°ë‹¨Â·ê¸‰ë³€', type:'negative'},
  {n:11, code:'Whip', kr:'ì±„ì°', key:'ë°˜ë³µÂ·ë…¼ìŸÂ·ìŠ¤íŠ¸ë ˆìŠ¤', type:'negative'},
  {n:12, code:'Bird', kr:'ìƒˆ', key:'ì—°ë½Â·ëŒ€í™”Â·ì†Œì‹', type:'neutral'},
  {n:13, code:'Child', kr:'ì•„ì´', key:'ìƒˆì‹œì‘Â·ìˆœìˆ˜Â·ì‘ìŒ', type:'neutral'},
  {n:14, code:'Fox', kr:'ì—¬ìš°', key:'ì£¼ì˜Â·ê³„ì‚°Â·ìì˜', type:'negative'},
  {n:15, code:'Bear', kr:'ê³°', key:'ì¬ì •Â·ê¶Œìœ„Â·ë³´í˜¸', type:'neutral'},
  {n:16, code:'Stars', kr:'ë³„', key:'ë¹„ì „Â·í¬ë§Â·ì¸ì‚¬ì´íŠ¸', type:'positive'},
  {n:17, code:'Stork', kr:'í™©ìƒˆ', key:'ë³€í™”Â·ì´ë™Â·ì—…ê·¸ë ˆì´ë“œ', type:'positive'},
  {n:18, code:'Dog', kr:'ê°œ', key:'ì‹ ë¢°Â·ìš°ì •Â·íŒŒíŠ¸ë„ˆ', type:'positive'},
  {n:19, code:'Tower', kr:'íƒ‘', key:'ê¸°ê´€Â·ê±°ë¦¬ë‘ê¸°Â·êµ¬ì¡°', type:'neutral'},
  {n:20, code:'Garden', kr:'ì •ì›', key:'ê³µê°œÂ·ëª¨ì„Â·í‰íŒ', type:'neutral'},
  {n:21, code:'Mountain', kr:'ì‚°', key:'ì¥ì• Â·ì§€ì—°Â·ì¥ë²½', type:'negative'},
  {n:22, code:'Crossroad', kr:'ê°ˆë¦¼ê¸¸', key:'ì„ íƒÂ·ê²°ì •Â·ë¶„ê¸°', type:'neutral'},
  {n:23, code:'Mice', kr:'ì¥', key:'ì†Œëª¨Â·ì†ì‹¤Â·ë¶ˆì•ˆ', type:'negative'},
  {n:24, code:'Heart', kr:'í•˜íŠ¸', key:'ì‚¬ë‘Â·í˜¸ì˜Â·ê³µê°', type:'positive'},
  {n:25, code:'Ring', kr:'ë°˜ì§€', key:'ê³„ì•½Â·ìˆœí™˜Â·ì•½ì†', type:'positive'},
  {n:26, code:'Book', kr:'ì±…', key:'ë¹„ë°€Â·í•™ìŠµÂ·ìë£Œ', type:'neutral'},
  {n:27, code:'Letter', kr:'í¸ì§€', key:'ë¬¸ì„œÂ·ë©”ì¼Â·ì¦ë¹™', type:'neutral'},
  {n:28, code:'Man', kr:'ë‚¨ì„±', key:'í•µì‹¬ ì¸ë¬¼(ë‚¨ì„±)', type:'neutral'},
  {n:29, code:'Woman', kr:'ì—¬ì„±', key:'í•µì‹¬ ì¸ë¬¼(ì—¬ì„±)', type:'neutral'},
  {n:30, code:'Lily', kr:'ë°±í•©', key:'í‰í™”Â·ì„±ìˆ™Â·íœ´ì‹', type:'positive'},
  {n:31, code:'Sun', kr:'íƒœì–‘', key:'ì„±ê³µÂ·í™œë ¥Â·ê°€ì‹œí™”', type:'positive'},
  {n:32, code:'Moon', kr:'ë‹¬', key:'ê°ì •Â·ëª…ì˜ˆÂ·ì¸ì •', type:'neutral'},
  {n:33, code:'Key', kr:'ì—´ì‡ ', key:'í•´ê²°Â·ì •ë‹µÂ·ëŒíŒŒ', type:'positive'},
  {n:34, code:'Fish', kr:'ë¬¼ê³ ê¸°', key:'ìì›Â·ê±°ë˜Â·íë¦„', type:'positive'},
  {n:35, code:'Anchor', kr:'ë‹»', key:'ì•ˆì •Â·ê³ ì •Â·ì¥ê¸°', type:'neutral'},
  {n:36, code:'Cross', kr:'ì‹­ìê°€', key:'ë¬´ê²ŒÂ·ì‹œí—˜Â·ì±…ì„', type:'negative'},
];
const byNum=new Map(CARDS.map(c=>[c.n,c]));
const src = n => `images/ë ˆë…¸ë¨¼ë“œ-${String(n).padStart(2,'0')}.png`;

/* ---------- ê³µí†µ ìœ í‹¸ ---------- */
const drawArea = document.getElementById('draw');
const sumBox   = document.getElementById('summary');
const qToggle  = document.getElementById('qToggle');
const qInput   = document.getElementById('qInput');
const qBox     = document.getElementById('questionBox');

qToggle.addEventListener('change',()=>{
  qInput.style.display = qToggle.checked ? 'inline-block' : 'none';
  if(!qToggle.checked) qInput.value='';
});

function toneChip(type){
  if(type==='positive') return '<span class="t-pos">ğŸ”µ ê¸ì •</span>';
  if(type==='negative') return '<span class="t-neg">ğŸ”´ ë¶€ì •</span>';
  return '<span class="t-neu">ğŸŸ¢ ì¤‘ë¦½</span>';
}
function mini(c){
  return `<article class="card-mini">
    <div class="row"><span class="chip">${c.n}</span><span class="chip">${c.code}</span>${toneChip(c.type)}</div>
    <div class="img"><img src="${src(c.n)}" alt="${c.n}. ${c.code}"></div>
    <h4>${c.n}. ${c.code} (${c.kr})</h4>
    <p>${c.key}</p>
  </article>`;
}
function pick(n){ // ì¤‘ë³µ ì—†ì´ nì¥
  const nums=[...Array(36).keys()].map(i=>i+1);
  const out=[];
  while(out.length<n) out.push(nums.splice(Math.floor(Math.random()*nums.length),1)[0]);
  return out.map(x=>byNum.get(x));
}

/* ---------- 1/3/5ì¹´ë“œ ---------- */
document.getElementById('btn1').onclick = ()=>{
  const cards=pick(1);
  drawArea.className='draw-result';
  drawArea.innerHTML = cards.map(mini).join('');
  showQuestion();
  sumBox.style.display='none';
};
document.getElementById('btn3').onclick = ()=>{
  const cards=pick(3);
  drawArea.className='draw-result';
  drawArea.style.justifyContent='center';
  drawArea.innerHTML = cards.map(mini).join('');
  showQuestion();
  sumBox.style.display='none';
};
document.getElementById('btn5').onclick = ()=>{
  const cards=pick(5);
  drawArea.className='draw-result draw-5';
  drawArea.innerHTML = cards.map(mini).join('');
  showQuestion();
  fiveSummary(cards);
};

/* 5ì¹´ë“œ ìë™ ì´í‰ */
function fiveSummary(cards){
  const pos=cards.filter(c=>c.type==='positive').length;
  const neg=cards.filter(c=>c.type==='negative').length;
  const neu=cards.length-pos-neg;
  let tone='ğŸŸ¢ ê· í˜•';
  if(pos>neg) tone='ğŸ”µ ìš°í˜¸ì ';
  else if(neg>pos) tone='ğŸ”´ ì‹ ì¤‘';
  const bullets=[];
  if(cards.some(c=>[33,31,9].includes(c.n))) bullets.push('ê²°ê³¼ ê°€ì‹œí™”Â·í•´ê²°ì˜ ì‹¤ë§ˆë¦¬');
  if(cards.some(c=>[25,27].includes(c.n))) bullets.push('ê³„ì•½/ë¬¸ì„œÂ·ê³µì  ì˜ì—­ ì²´í¬');
  if(cards.some(c=>[21,10,8,7,6].includes(c.n))) bullets.push('ë¦¬ìŠ¤í¬ ê´€ë¦¬Â·ì¼ì • ì¡°ì •');
  sumBox.style.display='inline-flex';
  sumBox.className='tone';
  sumBox.innerHTML = `<strong>ì „ì²´ í†¤:</strong> ${tone} &nbsp; (ê¸ì • ${pos} / ë¶€ì • ${neg} / ì¤‘ë¦½ ${neu})<br>
  â€¢ ${bullets.join('<br>â€¢ ') || 'í•µì‹¬ í¬ì¸íŠ¸ë¥¼ ìƒí™©ì— ë§ê²Œ ì ê²€í•˜ì„¸ìš”.'}`;
}

/* ì§ˆë¬¸ í‘œì‹œ */
function showQuestion(){
  if(qToggle.checked && qInput.value.trim()){
    qBox.style.display='inline-flex';
    qBox.innerHTML = `<strong>ì§ˆë¬¸:</strong> ${qInput.value.trim()}`;
  }else{
    qBox.style.display='none';
    qBox.textContent='';
  }
}

/* ---------- ì‹­ì ìŠ¤í”„ë ˆë“œ (ìë™ ì¶•ì†Œ) ---------- */
document.getElementById('btnCross').onclick = ()=>{
  const [center, left, right, top, bottom] = pick(5);
  drawArea.className='draw-result';
  drawArea.innerHTML = `
  <div class="cross-wrap">
    <div class="cross-box" id="crossScroll">
      <div class="cross-stage" id="crossStage">
        <div class="cross-grid" id="crossGrid">
          <div class="c"></div>
          <div class="c">${mini(top)}</div>
          <div class="c"></div>
          <div class="c">${mini(left)}</div>
          <div class="c">${mini(center)}</div>
          <div class="c">${mini(right)}</div>
          <div class="c"></div>
          <div class="c">${mini(bottom)}</div>
          <div class="c"></div>
        </div>
      </div>
    </div>
  </div>`;
  fitToScreen(document.getElementById('crossScroll'), document.getElementById('crossStage'));
  showQuestion();
  sumBox.style.display='none';
};

/* ---------- ê·¸ë‘íƒ€ë¸”ë¡œ (9Ã—4 / 8Ã—4+4) ---------- */
document.getElementById('btn9x4').onclick = ()=>grandTableau(9,4,false);
document.getElementById('btn8x4p4').onclick = ()=>grandTableau(8,4,true);

function grandTableau(cols, rows, essenceLast4){
  const order = pick(36).map(c=>c.n);            // ëœë¤ 36ì¥ ë²ˆí˜¸
  const head = `<div class="gt-toolbar">ì¹´ë“œë¥¼ ëˆŒëŸ¬ <strong>í‚¤ ì¹´ë“œ</strong>ì˜ <u>ì£¼ìœ„ ì¹´ë“œ</u>ì™€ <u>ë‚˜ì´íŒ…</u>ì„ í™•ì¸í•˜ì„¸ìš”.</div>`;
  const grid = `
    <div class="gt-scroll" id="gtScroll">
      <div class="gt-stage" id="gtStage">
        <div class="gt-grid" id="gtGrid" style="grid-template-columns:repeat(${cols},var(--card-w))">
          ${order.slice(0,cols*rows).map((n,i)=>{
            const c=byNum.get(n);
            return `<div class="card-mini gt-card" data-idx="${i}" data-num="${c.n}">
              <div class="row"><span class="chip">${c.n}</span><span class="chip">${c.code}</span>${toneChip(c.type)}</div>
              <div class="img"><img src="${src(c.n)}" alt="${c.n}. ${c.code}"></div>
              <h4>${c.n}. ${c.code} (${c.kr})</h4>
              <p>${c.key}</p>
            </div>`;
          }).join('')}
        </div>
      </div>
    </div>`;
  const ess = essenceLast4 ? `
    <div class="gt-toolbar"><strong>ì—ì„¼ìŠ¤ 4ì¥</strong> (ì•„ë˜ ìš”ì•½)</div>
    <div class="gt-scroll" id="gtEssScroll">
      <div class="gt-stage" id="gtEssStage">
        <div class="gt-grid" style="grid-template-columns:repeat(4,var(--card-w))">
          ${order.slice(cols*rows).map(n=>{
            const c=byNum.get(n);
            return `<div class="card-mini gt-card">
                <div class="row"><span class="chip">${c.n}</span><span class="chip">${c.code}</span>${toneChip(c.type)}</div>
                <div class="img"><img src="${src(c.n)}" alt="${c.n}. ${c.code}"></div>
                <h4>${c.n}. ${c.code} (${c.kr})</h4>
                <p>${c.key}</p>
            </div>`;
          }).join('')}
        </div>
      </div>
    </div>` : '';

  drawArea.className='draw-result';
  drawArea.innerHTML = `<div class="gt-wrap" id="gtWrap">${head}${grid}${ess}<div class="sidepanel" id="gtInfo">í‚¤ ì¹´ë“œë¥¼ ì„ íƒí•˜ë©´ í•´ì„ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div></div>`;
  sumBox.style.display='none';
  showQuestion();

  // í‚¤ ì¹´ë“œ í´ë¦­ â†’ ì£¼ìœ„/ë‚˜ì´íŒ… ê³„ì‚°
  const gridEl = document.getElementById('gtGrid');
  gridEl.querySelectorAll('.gt-card').forEach(el=>{
    el.addEventListener('click',()=>{
      const idx=+el.dataset.idx;
      const rc = i=>({r:Math.floor(i/cols),c:i%cols});
      const toIdx=(r,c)=>(r>=0&&r<rows&&c>=0&&c<cols)? r*cols+c : -1;
      const p=rc(idx);
      const neigh=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].map(([dr,dc])=>toIdx(p.r+dr,p.c+dc)).filter(i=>i>=0);
      const kn=[[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]].map(([dr,dc])=>toIdx(p.r+dr,p.c+dc)).filter(i=>i>=0);
      const num = +el.dataset.num;
      const around = neigh.map(i=> +gridEl.querySelector(`.gt-card[data-idx="${i}"]`).dataset.num);
      const knight = kn.map(i=> +gridEl.querySelector(`.gt-card[data-idx="${i}"]`).dataset.num);
      const list=(t,arr)=>`<div><strong>${t}</strong> â€” ${arr.map(n=>`${n}.${byNum.get(n).code}`).join(', ')||'ì—†ìŒ'}</div>`;
      document.getElementById('gtInfo').innerHTML =
        `<strong>í‚¤ ì¹´ë“œ:</strong> ${num}. ${byNum.get(num).code} (${byNum.get(num).kr}) â€” ${byNum.get(num).key}<br>`+
        list('ì£¼ìœ„ ì¹´ë“œ',around)+list('ë‚˜ì´íŒ…',knight);
    },{passive:true});
  });

  // ìë™ ì¶•ì†Œ
  const wrap=document.getElementById('gtWrap');
  Promise.all(Array.from(wrap.querySelectorAll('img')).map(img=>{
    if(img.complete) return true;
    return new Promise(res=>{img.addEventListener('load',res,{once:true});img.addEventListener('error',res,{once:true});});
  })).then(()=>{
    requestAnimationFrame(()=>{ fitToScreen(document.getElementById('gtScroll'), document.getElementById('gtStage'));
      if(essenceLast4) fitToScreen(document.getElementById('gtEssScroll'), document.getElementById('gtEssStage'));
      requestAnimationFrame(()=>{ fitToScreen(document.getElementById('gtScroll'), document.getElementById('gtStage'));
        if(essenceLast4) fitToScreen(document.getElementById('gtEssScroll'), document.getElementById('gtEssStage'));
      });
    });
  });

  const onResize=()=>{ fitToScreen(document.getElementById('gtScroll'), document.getElementById('gtStage'));
                      if(essenceLast4) fitToScreen(document.getElementById('gtEssScroll'), document.getElementById('gtEssStage')); };
  window.addEventListener('resize',onResize,{passive:true});
  window.visualViewport?.addEventListener('resize',onResize,{passive:true});
}

/* ë·°í¬íŠ¸ì— ë§ì¶° ìë™ ìŠ¤ì¼€ì¼(ëª¨ë°”ì¼ ì „ìš©) */
function fitToScreen(scrollEl, stageEl){
  if(!scrollEl||!stageEl) return;
  if(window.innerWidth>768){ // ë°ìŠ¤í¬í†±ì€ ìŠ¤ì¼€ì¼ í•´ì œ
    stageEl.style.transform='none';
    scrollEl.style.overflowX='auto';
    scrollEl.style.overflowY='hidden';
    scrollEl.style.height='';
    return;
  }
  const top = scrollEl.getBoundingClientRect().top;
  const vh  = (window.visualViewport?.height || window.innerHeight);
  const availW = scrollEl.clientWidth - 4;
  const availH = Math.max(260, vh - top - 16);

  const needW = stageEl.scrollWidth;
  const needH = stageEl.scrollHeight;

  const scale = Math.min(availW/needW, availH/needH, 0.96);
  stageEl.style.transform = `scale(${scale})`;
  scrollEl.style.height = `${Math.ceil(needH*scale)+8}px`;
  scrollEl.style.overflowX='auto';
  scrollEl.style.overflowY='hidden';
  scrollEl.style.webkitOverflowScrolling='touch';
}

/* ---------- ì¹´ë“œ ì „ì²´ ë³´ê¸° ---------- */
const toggleAll=document.getElementById('toggleAll');
const gallery=document.getElementById('gallery');
const filter=document.getElementById('filter');

toggleAll.onclick=()=>{
  const open = gallery.style.display!=='none';
  gallery.style.display = open ? 'none' : 'grid';
  if(!open) renderAll();
};
filter.oninput=()=>renderAll(filter.value.trim().toLowerCase());

function renderAll(term=''){
  const list=CARDS.filter(c=>{
    const t=`${c.n} ${c.code} ${c.kr}`.toLowerCase();
    return t.includes(term);
  });
  gallery.innerHTML = list.map(c=>`
    <article class="gcard">
      <div class="row"><span class="chip">${c.n}</span><span class="chip">${c.code}</span>${toneChip(c.type)}</div>
      <div class="img"><img src="${src(c.n)}" alt=""></div>
      <h4>${c.n}. ${c.code} (${c.kr})</h4>
      <p>${c.key}</p>
    </article>`).join('');
}
</script>
</body>
</html>