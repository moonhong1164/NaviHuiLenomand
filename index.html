<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>NAVI&HUI LENORMAND</title>
<meta name="description" content="1/3/5ì¹´ë“œ, ì‹­ì, ê·¸ë‘ë”°ë¸”ë¡œ(9x4, 8x4+4) Â· ëª¨ë°”ì¼ ë§ì¶¤ ì¶•ì†Œ" />
<style>
  :root{
    --bg:#efe8ff;               /* ì—°ë³´ë¼ ë°°ê²½ */
    --panel:#f6f1ff;            /* ì—°í•œ ë³´ë¼ ì¹´ë“œì˜ì—­ */
    --ink:#3a2e5f;              /* ê¸°ë³¸ ê¸€ì */
    --muted:#6b5a99;
    --ring:#d8c8ff;
    --card:#ffffff;
    --shadow:0 10px 30px rgba(82,55,155,.18);
    --chip:#ede3ff;
    --good:#2b82ff;             /* ê¸ì •(íŒŒë‘) */
    --bad:#ff3b3b;              /* ë¶€ì •(ë¹¨ê°•) */
    --neutral:#19a65c;          /* ì¤‘ë¦½(ì´ˆë¡) */
    --card-w:210px;             /* ê¸°ë³¸ ì¹´ë“œ í­ */
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,Apple SD Gothic Neo,Segoe UI,Roboto,Arial,sans-serif}
  header{position:sticky;top:0;z-index:10;background:linear-gradient(180deg,#f2eaffCC,#f2eaff80 70%,#0000);backdrop-filter:blur(6px)}
  .container{max-width:1100px;margin:0 auto;padding:16px}
  h1{margin:4px 0 0;font-size:26px;letter-spacing:.4px}

  .toolbar{background:var(--panel);border:1px solid var(--ring);border-radius:16px;box-shadow:var(--shadow);padding:14px;display:flex;flex-wrap:wrap;gap:10px;align-items:center}
  .btn{display:inline-flex;align-items:center;gap:6px;border-radius:12px;border:1px solid var(--ring);background:var(--card);padding:10px 14px;cursor:pointer;box-shadow:var(--shadow)}
  .chip{padding:4px 10px;border-radius:999px;background:var(--chip);border:1px solid var(--ring);color:var(--muted);font-size:12px}
  input[type="checkbox"]{transform:translateY(1px)}
  #question{display:none;width:100%;margin-top:6px;border:1px solid var(--ring);background:#fff;border-radius:10px;padding:10px 12px}

  /* ê²°ê³¼ ì¹´ë“œ ì˜ì—­ */
  .draw{margin:14px 0}
  .cards{display:grid;gap:14px}
  .draw-1{grid-template-columns:repeat(1,var(--card-w));justify-content:center}
  .draw-3{grid-template-columns:repeat(3,var(--card-w));justify-content:center} /* 3ì¹´ë“œ ê°€ë¡œ ê³ ì • */
  .draw-5{grid-template-columns:repeat(5,var(--card-w));justify-content:center}
  .card-mini{width:var(--card-w);background:var(--card);border:1px solid var(--ring);border-radius:18px;box-shadow:var(--shadow);padding:12px}
  .card-mini h4{margin:6px 0 6px;font-size:18px}
  .img{width:100%;aspect-ratio:3/4;border-radius:14px;border:1px solid var(--ring);background:#e9e2ff;display:flex;align-items:center;justify-content:center;overflow:hidden}
  .img img{width:100%;height:100%;object-fit:contain} /* ì´ë¯¸ì§€ ì˜ë¦¼ ë°©ì§€ */

  /* í•€ + í…Œë‘ë¦¬ ìƒ‰(ê¸/ë¶€/ì¤‘) */
  .pin{position:absolute;top:8px;right:8px;width:16px;height:16px;border-radius:50%;box-shadow:0 2px 6px #0002}
  .tone-good  {border-color:var(--good); outline:2px solid #0000; box-shadow:var(--shadow)}
  .tone-bad   {border-color:var(--bad)}
  .tone-neutral{border-color:var(--neutral)}
  .tone-good .pin{background:var(--good)}
  .tone-bad .pin{background:var(--bad)}
  .tone-neutral .pin{background:var(--neutral)}
  .tone-good h4 b{color:var(--good)}
  .tone-bad h4 b{color:var(--bad)}
  .tone-neutral h4 b{color:var(--neutral)}
  .card-mini{position:relative;border:2px solid transparent}

  /* ì‹­ì ìŠ¤í”„ë ˆë“œ ë°•ìŠ¤ (ëª¨ë°”ì¼ì—ì„œë„ í•œ ë°•ìŠ¤ì— ìˆ˜ë‚©) */
  .cross-wrap{display:flex;justify-content:center}
  .cross-box{position:relative;border:1px dashed var(--ring);background:var(--panel);border-radius:16px;padding:14px;width:min(520px,96vw)}
  .cross-grid{display:grid;grid-template-columns:repeat(3,var(--card-w));justify-content:center;gap:12px;transform-origin:top left}
  .cross-grid .card-mini{margin:auto}

  /* ê·¸ë‘ë”°ë¸”ë¡œ */
  .gt-wrap{display:grid;grid-template-columns:1fr 300px;gap:14px}
  .gt-toolbar{background:var(--panel);border:1px solid var(--ring);border-radius:12px;padding:10px 12px;color:var(--muted)}
  .gt-scroll{border:1px solid var(--ring);border-radius:14px;background:var(--panel);padding:8px;position:relative;overflow:hidden}
  .gt-stage{transform-origin:top left;display:inline-block}
  .gt-grid{display:grid;gap:8px}
  .sidepanel{background:var(--panel);border:1px solid var(--ring);border-radius:14px;padding:12px;box-shadow:var(--shadow)}
  @media (max-width:900px){
    .gt-wrap{grid-template-columns:1fr}
  }

  /* ì¹´ë“œ ì „ì²´ ë³´ê¸° */
  .all-btn{margin:8px 0}
  .all-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px}
  .legend{display:flex;gap:10px;align-items:center}
  .dot{width:11px;height:11px;border-radius:50%}
  .dot.good{background:var(--good)} .dot.bad{background:var(--bad)} .dot.neutral{background:var(--neutral)}

  footer{margin:30px 0 50px;text-align:center;color:var(--muted)}
</style>
</head>
<body>
<header><div class="container"><h1>NAVI&HUI LENORMAND</h1></div></header>

<main class="container">
  <!-- ìƒë‹¨ ë„êµ¬ -->
  <div class="toolbar">
    <label class="chip"><input type="checkbox" id="askToggle"> ì§ˆë¬¸ ì…ë ¥</label>
    <button class="btn" id="btn1">ğŸƒ 1ì¹´ë“œ</button>
    <button class="btn" id="btn3">ğŸƒğŸƒğŸƒ 3ì¹´ë“œ</button>
    <button class="btn" id="btn5">ğŸƒğŸƒğŸƒğŸƒğŸƒ 5ì¹´ë“œ</button>
    <button class="btn" id="btnCross">â• ì‹­ì</button>
    <button class="btn" id="btnGT94">ğŸ§© 9Ã—4</button>
    <button class="btn" id="btnGT844">ğŸ§© 8Ã—4+4</button>
    <input id="question" type="text" placeholder="ì§ˆë¬¸ì„ ì ì–´ ì£¼ì„¸ìš” (ì„ íƒ)">
  </div>

  <!-- ê²°ê³¼ -->
  <section class="draw">
    <div id="result" class="cards draw-1"></div>
    <div id="summary" class="sidepanel" style="display:none"></div>
  </section>

  <div class="all-btn">
    <button class="btn" id="btnAll">ğŸ“ ì¹´ë“œ ì „ì²´ ë³´ê¸°</button>
  </div>
  <div id="allWrap" style="display:none">
    <div class="legend chip">
      <span class="dot good"></span> ê¸ì • &nbsp;
      <span class="dot bad"></span> ë¶€ì • &nbsp;
      <span class="dot neutral"></span> ì¤‘ë¦½
    </div>
    <div id="allGrid" class="all-grid" style="margin-top:8px"></div>
  </div>

  <footer>ì œì‘ : ë‚˜ë¹„ğŸ¦‹, ì›”í™ğŸŒ™</footer>
</main>

<script>
/* ===== ë°ì´í„°: ë²ˆí˜¸/ì˜ë¬¸/í•œê¸€/í‚¤ì›Œë“œ/í†¤(positive|negative|neutral) =====
   ì´ë¯¸ì§€ íŒŒì¼ëª…: images/ë ˆë…¸ë¨¼ë“œ-01.png ~ images/ë ˆë…¸ë¨¼ë“œ-36.png  */
const CARDS=(()=>{const D=[
  [1,'Rider','ê¸°ìˆ˜','ì†Œì‹Â·ì†ë„Â·ë„ì°©','neutral'],
  [2,'Clover','í´ë¡œë²„','í–‰ìš´Â·ê¸°íšŒÂ·ì§§ì€ í˜¸ì¬','positive'],
  [3,'Ship','ì„ ë°•','ì´ë™Â·í™•ì¥Â·ê±°ë¦¬','neutral'],
  [4,'House','ì§‘','ì•ˆì •Â·ê°€ì •Â·ê¸°ë°˜','positive'],
  [5,'Tree','ë‚˜ë¬´','ê±´ê°•Â·ì„±ì¥Â·ì‹œê°„','neutral'],
  [6,'Cloud','êµ¬ë¦„','í˜¼ë€Â·ë¶ˆí™•ì‹¤Â·íŒë‹¨ë³´ë¥˜','negative'],
  [7,'Snake','ë±€','ìœ í˜¹Â·ì¥ì• Â·ìš°íšŒ','negative'],
  [8,'Coffin','ê´€','ëÂ·ì •ë¦¬Â·ì „í™˜','negative'],
  [9,'Bouquet','ë¶€ì¼€','ê¸°ì¨Â·ì„ ë¬¼Â·í˜¸ì˜','positive'],
  [10,'Scythe','ë‚«','ë‹¨ì ˆÂ·ê²°ë‹¨Â·ìˆ˜ìˆ ','negative'],
  [11,'Whip','ì±„ì°','ê°ˆë“±Â·ë°˜ë³µÂ·ë£¨í”„','negative'],
  [12,'Bird','ìƒˆ','ëŒ€í™”Â·ì†Œí†µÂ·ê¸´ì¥','neutral'],
  [13,'Child','ì•„ì´','ìƒˆì‹œì‘Â·ìˆœìˆ˜Â·ì‘ìŒ','positive'],
  [14,'Fox','ì—¬ìš°','ì˜ì‹¬Â·ì¼Â·ì˜ë¦¬í•¨','neutral'],
  [15,'Bear','ê³°','ê¶Œìœ„Â·ì¬ì •Â·ë³´í˜¸','neutral'],
  [16,'Stars','ë³„','ë¹„ì „Â·ì˜ê°Â·ëª…í™•','positive'],
  [17,'Stork','í™©ìƒˆ','ë³€í™”Â·ì´ë™Â·ì—…ê·¸ë ˆì´ë“œ','positive'],
  [18,'Dog','ê°œ','ì‹ ë¢°Â·ìš°ì •Â·íŒŒíŠ¸ë„ˆ','positive'],
  [19,'Tower','íƒ‘','ì œë„Â·ê±°ë¦¬ê°Â·ìœ„ê³„','neutral'],
  [20,'Garden','ì •ì›','ê³µê°œÂ·ë„¤íŠ¸ì›Œí¬Â·ëª¨ì„','neutral'],
  [21,'Mountain','ì‚°','ì¥ì• ë¬¼Â·ì§€ì—°Â·ë²½','negative'],
  [22,'Crossroad','ê°ˆë¦¼ê¸¸','ì„ íƒÂ·ê²°ì •Â·ë¶„ê¸°','neutral'],
  [23,'Mice','ì¥','ì†Œëª¨Â·ë¶ˆì•ˆÂ·ëˆ„ìˆ˜','negative'],
  [24,'Heart','í•˜íŠ¸','ì‚¬ë‘Â·ì—´ì •Â·í˜¸ê°','positive'],
  [25,'Ring','ë°˜ì§€','ê³„ì•½Â·ìˆœí™˜Â·ì•½ì†','positive'],
  [26,'Book','ì±…','ë¹„ë°€Â·í•™ìŠµÂ·ë¬¸ì„œ','neutral'],
  [27,'Letter','í¸ì§€','ì—°ë½Â·ë¬¸ì„œÂ·ì•Œë¦¼','neutral'],
  [28,'Man','ë‚¨ì„±','í•µì‹¬ ì¸ë¬¼(ë‚¨)','neutral'],
  [29,'Woman','ì—¬ì„±','í•µì‹¬ ì¸ë¬¼(ì—¬)','neutral'],
  [30,'Lily','ë°±í•©','í‰í™”Â·ì„±ìˆ™Â·íœ´ì‹','positive'],
  [31,'Sun','íƒœì–‘','ì„±ê³µÂ·í™œë ¥Â·ì„±ê³¼','positive'],
  [32,'Moon','ë‹¬','ê°ì •Â·ëª…ì˜ˆÂ·ë¦¬ë“¬','neutral'],
  [33,'Key','ì—´ì‡ ','í•´ê²°Â·ì •ë‹µÂ·ëŒíŒŒêµ¬','positive'],
  [34,'Fish','ë¬¼ê³ ê¸°','ì¬ë¬¼Â·ê±°ë˜Â·íë¦„','neutral'],
  [35,'Anchor','ë‹»','ì•ˆì •Â·ê³ ì •Â·ì§€ì†ì„±','positive'],
  [36,'Cross','ì‹­ìê°€','ê³ ë‚œÂ·ì±…ì„Â·ë²„í‹°ê¸°','negative'],
];return D.map(([n,code,kr,key,type])=>({n,code,kr,key,type}));})();

const byNum=new Map(CARDS.map(c=>[c.n,c]));

const $=sel=>document.querySelector(sel);
const result=$("#result"), summary=$("#summary");
const askToggle=$("#askToggle"), question=$("#question");
askToggle.addEventListener('change',()=>{question.style.display=askToggle.checked?'block':'none'});

const src=n=>`images/ë ˆë…¸ë¨¼ë“œ-${String(n).padStart(2,'0')}.png`;

function mini(c){
  const toneClass = c.type==='positive'?'tone-good':(c.type==='negative'?'tone-bad':'tone-neutral');
  const toneTag  = c.type==='positive'?'ğŸ”µ ê¸ì •':(c.type==='negative'?'ğŸ”´ ë¶€ì •':'ğŸŸ¢ ì¤‘ë¦½');
  return `<article class="card-mini ${toneClass}">
    <span class="pin"></span>
    <div class="img"><img src="${src(c.n)}" alt=""></div>
    <h4><b>${c.n}. ${c.code}</b> (${c.kr})</h4>
    <p>${c.key}</p>
    <div class="chip">${toneTag}</div>
  </article>`;
}

function pick(n){
  const used=new Set(); const arr=[];
  while(arr.length<n){
    const c=CARDS[Math.floor(Math.random()*CARDS.length)];
    if(!used.has(c.n)){used.add(c.n);arr.push(c);}
  }
  return arr;
}

function jump(){ result.scrollIntoView({behavior:'smooth',block:'start'}); }

function draw1(){ const cs=pick(1); result.className='cards draw-1'; result.innerHTML=cs.map(mini).join(''); summary.style.display='none'; showQ(); jump(); }
function draw3(){ const cs=pick(3); result.className='cards draw-3'; result.innerHTML=cs.map(mini).join(''); summary.style.display='none'; showQ(); jump(); }
function draw5(){
  const cs=pick(5); result.className='cards draw-5'; result.innerHTML=cs.map(mini).join('');
  // 5ì¹´ë“œ ìë™ ì´í‰(ìƒì„¸)
  const pos=cs.filter(c=>c.type==='positive').length;
  const neg=cs.filter(c=>c.type==='negative').length;
  const neu=cs.length-pos-neg;
  const tone = pos>neg? 'ğŸ”µ ìš°í˜¸ì ' : (neg>pos? 'ğŸ”´ ê²½ê³„' : 'ğŸŸ¢ ì¤‘ë¦½');
  const hints = [
    'ì¶”ì§„ ì‹ í˜¸ â€” ê²°ê³¼ ê°€ì‹œí™” / í•´ê²°ì˜ ì‹¤ë§ˆë¦¬',
    'ë¦¬ìŠ¤í¬ ê´€ë¦¬ â€” ì§€ì—°Â·ë‹¨ì ˆÂ·í˜¼ì„  ê°€ëŠ¥, ì¼ì • ì¡°ì •',
    'ë¬¸ì„œÂ·ê³„ì•½Â·ì—°ë½ â€” ê³µì‹ ì±„ë„ ì²´í¬',
    'ê´€ê³„/í‰íŒ â€” ê³µê°œ ì˜ì—­ì—ì„œì˜ ì´ë¯¸ì§€ ê´€ë¦¬',
    'ì¬ì •/ìì› â€” íë¦„ ì ê²€, ì§€ì†ê°€ëŠ¥ì„± í™•ì¸'
  ];
  summary.style.display='block';
  summary.innerHTML=`<div><strong>ì „ì²´ í†¤:</strong> ${tone} <span class="chip">ê¸ì • ${pos} / ë¶€ì • ${neg} / ì¤‘ë¦½ ${neu}</span></div>
  <ul style="margin:6px 0 0 18px">${hints.map(h=>`<li>${h}</li>`).join('')}</ul>`;
  showQ(); jump();
}

function showQ(){
  if(askToggle.checked && question.value.trim()){
    const box = document.createElement('div');
    box.className='chip';
    box.style.margin='6px 0';
    box.textContent='ì§ˆë¬¸: '+question.value.trim();
    result.prepend(box);
  }
}

/* ========== ì‹­ì ìŠ¤í”„ë ˆë“œ (ìƒÂ·ì¢ŒÂ·ì¤‘Â·ìš°Â·í•˜) ========== */
function drawCross(){
  const cs=pick(5); // 0~4
  const wrap=document.createElement('div'); wrap.className='cross-wrap';
  const box=document.createElement('div');  box.className='cross-box';
  const grid=document.createElement('div'); grid.className='cross-grid';
  // ë°°ì¹˜: [ìƒ,ì¢Œ,ì¤‘,ìš°,í•˜]
  const order=[0,1,2,3,4];
  grid.innerHTML=order.map(i=>mini(cs[i])).join('');
  box.appendChild(grid); wrap.appendChild(box);
  result.className='cards'; result.innerHTML=''; result.appendChild(wrap);
  summary.style.display='none'; showQ(); jump();

  // ë°•ìŠ¤ì— ë§ì¶° ìë™ ìŠ¤ì¼€ì¼
  forceFitGrid(box,grid,0.98);
  window.addEventListener('resize',()=>forceFitGrid(box,grid,0.98),{passive:true});
  window.visualViewport?.addEventListener('resize',()=>forceFitGrid(box,grid,0.98),{passive:true});
}

/* ========== ê·¸ë‘ë”°ë¸”ë¡œ(ëª¨ë°”ì¼ í•œ í™”ë©´ ë§ì¶¤) ========== */
function grandTableau(cols, rows, essenceLast4){
  const order=pick(36).map(c=>c.n);
  // ëª¨ë°”ì¼ ì„ì‹œ ì¹´ë“œí­ ì¶•ì†Œ
  const rootStyle=document.documentElement.style;
  const prevW=getComputedStyle(document.documentElement).getPropertyValue('--card-w');
  const mobile=window.innerWidth<=768;
  if(mobile){ rootStyle.setProperty('--card-w', cols===9?'150px':'140px'); }

  const head=`<div class="gt-toolbar">ì¹´ë“œë¥¼ ëˆŒëŸ¬ <strong>í‚¤ ì¹´ë“œ</strong>ì˜ ì£¼ìœ„ ì¹´ë“œì™€ ë‚˜ì´íŒ…ì„ í™•ì¸í•˜ì„¸ìš”.</div>`;
  const grid=`<div class="gt-scroll" id="gtScroll"><div class="gt-stage" id="gtStage">
    <div class="gt-grid" id="gtGrid" style="grid-template-columns:repeat(${cols},var(--card-w))">
      ${order.slice(0,cols*rows).map((n,i)=>{const c=byNum.get(n);return `
        <div class="card-mini ${c.type==='positive'?'tone-good':(c.type==='negative'?'tone-bad':'tone-neutral')} gt-card" data-idx="${i}" data-num="${c.n}">
          <span class="pin"></span>
          <div class="img"><img src="${src(c.n)}" alt=""></div>
          <h4><b>${c.n}. ${c.code}</b> (${c.kr})</h4>
          <p>${c.key}</p>
        </div>`}).join('')}
    </div></div></div>`;

  const ess = essenceLast4 ? `<div class="gt-toolbar"><strong>ì—ì„¼ìŠ¤ 4ì¥</strong></div>
    <div class="gt-scroll" id="gtEssScroll"><div class="gt-stage" id="gtEssStage">
      <div class="gt-grid" style="grid-template-columns:repeat(4,var(--card-w))">
        ${order.slice(cols*rows).map(n=>{const c=byNum.get(n);return `
          <div class="card-mini ${c.type==='positive'?'tone-good':(c.type==='negative'?'tone-bad':'tone-neutral')}">
            <span class="pin"></span>
            <div class="img"><img src="${src(c.n)}" alt=""></div>
            <h4><b>${c.n}. ${c.code}</b> (${c.kr})</h4>
            <p>${c.key}</p>
          </div>`}).join('')}
      </div></div></div>` : '';

  result.className='cards'; result.innerHTML=`<div class="gt-wrap" id="gtWrap">${head}${grid}${ess}<div class="sidepanel" id="gtInfo">í‚¤ ì¹´ë“œë¥¼ ì„ íƒí•˜ë©´ í•´ì„ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div></div>`;
  summary.style.display='none'; showQ(); jump();

  const gridEl=$("#gtGrid");
  gridEl.querySelectorAll('.gt-card').forEach(el=>{
    el.addEventListener('click',()=>{
      const idx=+el.dataset.idx, rc=i=>({r:Math.floor(i/cols),c:i%cols}), toIdx=(r,c)=>(r>=0&&r<rows&&c>=0&&c<cols)?r*cols+c:-1;
      const p=rc(idx);
      const neigh=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].map(([dr,dc])=>toIdx(p.r+dr,p.c+dc)).filter(i=>i>=0);
      const kn=[[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]].map(([dr,dc])=>toIdx(p.r+dr,p.c+dc)).filter(i=>i>=0);
      const num=+el.dataset.num;
      const around=neigh.map(i=>+gridEl.querySelector(`.gt-card[data-idx="${i}"]`).dataset.num);
      const knight=kn.map(i=>+gridEl.querySelector(`.gt-card[data-idx="${i}"]`).dataset.num);
      const list=(t,a)=>`<div style="margin:.25rem 0"><strong>${t}</strong> â€” ${a.map(n=>`${n}.${byNum.get(n).code}`).join(', ')||'ì—†ìŒ'}</div>`;
      $("#gtInfo").innerHTML=`<strong>í‚¤ ì¹´ë“œ:</strong> ${num}. ${byNum.get(num).code} (${byNum.get(num).kr}) â€” ${byNum.get(num).key}
        ${list('ì£¼ìœ„ ì¹´ë“œ',around)}${list('ë‚˜ì´íŒ…',knight)}`;
    },{passive:true});
  });

  // ì´ë¯¸ì§€ ë¡œë”© í›„ í™”ë©´ ë§ì¶¤(ì—¬ìœ  ë¹„ìœ¨ í¬í•¨)
  const wrap=$("#gtWrap");
  const imgs=[...wrap.querySelectorAll('img')];
  const wait=Promise.all(imgs.map(img=>img.complete?true:new Promise(res=>{img.addEventListener('load',res,{once:true});img.addEventListener('error',res,{once:true});})));
  const fitAll=()=>{
    forceFitGrid($("#gtScroll"),$("#gtStage"),0.96);   // ë³¸ ê·¸ë¦¬ë“œ
    if(essenceLast4) forceFitGrid($("#gtEssScroll"),$("#gtEssStage"),0.98); // ì—ì„¼ìŠ¤
  };
  wait.then(()=>{fitAll(); requestAnimationFrame(fitAll); setTimeout(fitAll,120);});
  const onR=()=>fitAll();
  window.addEventListener('resize',onR,{passive:true});
  window.visualViewport?.addEventListener('resize',onR,{passive:true});

  // ë– ë‚  ë•Œ ì¹´ë“œí­ ë³µì›
  const observer=new IntersectionObserver((ents)=>{
    ents.forEach(e=>{ if(!e.isIntersecting && mobile){ rootStyle.setProperty('--card-w', (prevW||'210px').trim()); }});
  });
  observer.observe(result);
}

/* í™”ë©´ ë§ì¶¤ ìŠ¤ì¼€ì¼ëŸ¬: scrollEl ì•ˆì— stageElì„ ì¶•ì†Œì‹œì¼œ í•œ í™”ë©´ ìˆ˜ë‚© */
function forceFitGrid(scrollEl, stageEl, pad=0.98){
  if(!scrollEl||!stageEl) return;
  const isMobile=window.innerWidth<=768;
  stageEl.style.transform='none';
  if(!isMobile){ scrollEl.style.overflow='auto'; scrollEl.style.height=''; return; }
  const top=scrollEl.getBoundingClientRect().top;
  const vh1=window.innerHeight, vh2=(window.visualViewport?.height||vh1);
  const availH=Math.max(220, Math.min(vh1,vh2)-top-12);
  const availW=scrollEl.clientWidth-6;
  const needW=stageEl.scrollWidth;
  const needH=stageEl.scrollHeight;
  const scale=Math.min((availW/needW)*pad,(availH/needH)*pad,1);
  stageEl.style.transform=`scale(${scale})`;
  scrollEl.style.height=`${Math.ceil(needH*scale)+8}px`;
  scrollEl.style.overflow='hidden';
  scrollEl.style.webkitOverflowScrolling='touch';
}

/* ì¹´ë“œ ì „ì²´ ë³´ê¸° */
function renderAll(){
  const box=$("#allWrap"), grid=$("#allGrid");
  box.style.display = box.style.display==='none' ? 'block' : 'none';
  if(box.style.display==='none') return;
  grid.innerHTML=CARDS.map(mini).join('');
}

/* ì´ë²¤íŠ¸ */
$("#btn1").onclick=draw1;
$("#btn3").onclick=draw3;                 // ê°€ë¡œ 3ì—´ ê³ ì •
$("#btn5").onclick=draw5;
$("#btnCross").onclick=drawCross;
$("#btnGT94").onclick=()=>grandTableau(9,4,false);
$("#btnGT844").onclick=()=>grandTableau(8,4,true);
$("#btnAll").onclick=renderAll;

/* ì²˜ìŒ ì§„ì… ìƒíƒœ */
draw3(); // ê¸°ë³¸ ë¯¸ë¦¬ ë³´ê¸°
</script>
</body>
</html>