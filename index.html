<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>NAVI&HUI LENORMAND</title>
<style>
:root{
  --bg:#efe7ff; --panel:#f7f3ff; --card:#fff; --ink:#2a2240; --muted:#6c6290; --ring:#d6c9ff;
  --gap:10px; --card-w:210px; --shadow:0 10px 26px rgba(84,64,140,.18);
  --pos:#22a531; --neg:#e53935; --neu:#2a64ff;
}
*{box-sizing:border-box} html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,Pretendard,Apple SD Gothic Neo,Segoe UI,sans-serif}
header{position:sticky;top:0;z-index:10;background:linear-gradient(180deg,#efe7ffcc,#efe7ff80 80%,transparent);backdrop-filter:blur(6px)}
.container{max-width:1100px;margin:0 auto;padding:14px 16px}
h1{margin:4px 0 10px;font-size:28px}

.controls{display:flex;flex-wrap:wrap;gap:10px;padding:14px;border:1px solid var(--ring);background:var(--panel);border-radius:16px;box-shadow:var(--shadow)}
.btn{display:inline-flex;align-items:center;gap:8px;padding:9px 14px;border:1px solid var(--ring);background:#fff;border-radius:12px;cursor:pointer}
.badge{display:inline-flex;align-items:center;gap:6px;padding:2px 10px;border-radius:999px;background:#fff;border:1px solid var(--ring);color:var(--muted);font-size:13px}
input[type="search"]{padding:10px 12px;border:1px solid var(--ring);border-radius:12px;background:#fff}

.stage{margin:14px 0}
.draw-result{display:grid;gap:12px;justify-content:center}
.card-mini{width:var(--card-w);background:var(--card);border:2px solid var(--ring);border-radius:16px;box-shadow:var(--shadow);padding:10px;position:relative}
.card-mini .img{width:100%;aspect-ratio:3/4;border-radius:12px;background:#e8defc;display:flex;align-items:center;justify-content:center;overflow:hidden}
.card-mini .img img{width:100%;height:100%;object-fit:contain;display:block}
.card-mini h4{margin:8px 6px 6px;font-size:18px}
.card-mini p{margin:6px}
.pin{position:absolute;right:10px;top:10px;width:18px;height:18px;border-radius:50%;box-shadow:0 2px 6px rgba(0,0,0,.2)}
.card-mini[data-tone="positive"]{border-color:var(--pos)} .card-mini[data-tone="positive"] .pin{background:var(--pos)}
.card-mini[data-tone="negative"]{border-color:var(--neg)} .card-mini[data-tone="negative"] .pin{background:var(--neg)}
.card-mini[data-tone="neutral"]{border-color:var(--neu)}  .card-mini[data-tone="neutral"]  .pin{background:var(--neu)}
.row{display:flex;gap:6px;flex-wrap:wrap}
.chip{font-size:12px;color:var(--muted);padding:2px 8px;border-radius:999px;background:#faf8ff;border:1px solid var(--ring)}
.tone{display:inline-flex;flex-direction:column;gap:6px;padding:10px 12px;border-radius:12px;background:#fff;border:1px solid var(--ring);box-shadow:var(--shadow);color:#493d71}

/* 5ì¹´ë“œ ê°€ë¡œ ê³ ì • */
.draw-5{grid-template-columns:repeat(5,var(--card-w))}

/* ì‹­ì */
.cross-wrap{border:1px solid var(--ring);border-radius:16px;background:var(--panel);padding:10px;box-shadow:var(--shadow)}
.cross-box{position:relative;width:100%;overflow:hidden}
.cross-stage{display:inline-block;transform-origin:top left}
.cross-grid{display:grid;grid-template-columns:repeat(3,var(--card-w));grid-auto-rows:auto;gap:var(--gap);width:max-content}

/* ê·¸ë‘ë”°ë¸”ë¡œ */
.gt-wrap{border:1px solid var(--ring);border-radius:16px;background:var(--panel);padding:10px;box-shadow:var(--shadow)}
.gt-toolbar{margin:6px 2px 10px;color:var(--muted)}
.gt-scroll{position:relative;width:100%;overflow:hidden;-webkit-overflow-scrolling:touch}
.gt-stage{display:inline-block;transform-origin:top left}
.gt-grid{display:inline-grid;width:max-content;gap:var(--gap);justify-content:start}
.gt-card{width:var(--card-w)}
.sidepanel{margin-top:10px;padding:10px 12px;border-radius:12px;background:#fff;border:1px solid var(--ring);box-shadow:var(--shadow);color:#493d71}

/* ê°¤ëŸ¬ë¦¬ */
.gallery-toggle{margin:14px 0 6px}
.grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fill,minmax(180px,1fr))}
.gcard{background:#fff;border:1px solid var(--ring);border-radius:16px;box-shadow:var(--shadow);padding:10px}
.gcard .img{width:100%;aspect-ratio:3/4;background:#e8defc;border-radius:12px;overflow:hidden}
.gcard .img img{width:100%;height:100%;object-fit:contain}

footer{padding:28px 16px;color:#8a7fb0;text-align:center}

/* ëª¨ë°”ì¼ì—ì„œ ìë™ ì¶•ì†Œë¥¼ ë„ì™€ì¤„ ì¹´ë“œ ê¸°ë³¸ í­ ì¶•ì†Œ */
@media (max-width:768px){
  :root{ --card-w:180px }
  .card-mini h4{font-size:16px}
  .card-mini p{font-size:14px}
}
@media (max-width:430px){
  :root{ --card-w:160px }
}
</style>
</head>
<body>
<header><div class="container"><h1>NAVI&HUI LENORMAND</h1></div></header>

<main class="container">
  <section class="controls">
    <label class="badge"><input id="qToggle" type="checkbox"> ì§ˆë¬¸ ì…ë ¥</label>
    <input id="qInput" type="search" placeholder="ì§ˆë¬¸(ì„ íƒ)" style="display:none">
    <button class="btn" id="btn1">ğŸƒ 1ì¹´ë“œ</button>
    <button class="btn" id="btn3">ğŸƒğŸƒğŸƒ 3ì¹´ë“œ</button>
    <button class="btn" id="btn5">ğŸƒğŸƒğŸƒğŸƒğŸƒ 5ì¹´ë“œ</button>
    <button class="btn" id="btnCross">â• ì‹­ì</button>
    <button class="btn" id="btn9x4">ğŸ§© 9Ã—4</button>
    <button class="btn" id="btn8x4p4">ğŸ§© 8Ã—4+4</button>
  </section>

  <section id="questionBox" class="tone" style="display:none;margin-top:10px"></section>

  <section class="stage">
    <div id="draw" class="draw-result"></div>
    <div id="summary" class="tone" style="display:none;margin-top:12px"></div>
  </section>

  <div class="gallery-toggle">
    <button class="btn" id="toggleAll">ğŸ“ ì¹´ë“œ ì „ì²´ ë³´ê¸°</button>
    <input id="filter" type="search" placeholder="ì¹´ë“œ ê²€ìƒ‰ (ë²ˆí˜¸/ì´ë¦„)">
  </div>
  <div id="gallery" class="grid" style="display:none"></div>
</main>

<footer>Â© NAVI & HUI</footer>

<script>
/* ===== ë°ì´í„°(ê¸/ë¶€/ì¤‘ë¦½ ì›ë˜ ë§¤í•‘) ===== */
const CARDS = [
  {n:1,  code:'Rider',    kr:'ê¸°ìˆ˜',   key:'ì†Œì‹Â·ë„ì°©Â·ë¹ ë¥¸ ì§„í–‰', type:'positive'},
  {n:2,  code:'Clover',   kr:'í´ë¡œë²„', key:'ê¸°íšŒÂ·í–‰ìš´Â·ì§§ì€ í˜¸ì¬', type:'positive'},
  {n:3,  code:'Ship',     kr:'ì„ ë°•',   key:'ì—¬í–‰Â·í™•ì¥Â·ì´ë™',       type:'positive'},
  {n:4,  code:'House',    kr:'ì§‘',     key:'ì•ˆì •Â·ê°€ì •Â·ê¸°ë°˜',       type:'positive'},
  {n:5,  code:'Tree',     kr:'ë‚˜ë¬´',   key:'ê±´ê°•Â·ì„±ì¥Â·ë¿Œë¦¬',       type:'neutral'},
  {n:6,  code:'Cloud',    kr:'êµ¬ë¦„',   key:'í˜¼ë€Â·ë¶ˆí™•ì‹¤Â·íŒë‹¨ ë³´ë¥˜', type:'negative'},
  {n:7,  code:'Snake',    kr:'ë±€',     key:'ìœ í˜¹Â·ì¥ì• Â·ìš°íšŒ',       type:'negative'},
  {n:8,  code:'Coffin',   kr:'ê´€',     key:'ëÂ·ì „í™˜Â·ì •ë¦¬',         type:'negative'},
  {n:9,  code:'Bouquet',  kr:'ë¶€ì¼€',   key:'ê¸°ì¨Â·ì„ ë¬¼Â·í˜¸ì˜',       type:'positive'},
  {n:10, code:'Scythe',   kr:'ë‚«',     key:'ë‹¨ì ˆÂ·ê²°ë‹¨Â·ê¸‰ë³€',       type:'negative'},
  {n:11, code:'Whip',     kr:'ì±„ì°',   key:'ë°˜ë³µÂ·ë…¼ìŸÂ·ìŠ¤íŠ¸ë ˆìŠ¤',   type:'negative'},
  {n:12, code:'Bird',     kr:'ìƒˆ',     key:'ì—°ë½Â·ëŒ€í™”Â·ì†Œì‹',       type:'neutral'},
  {n:13, code:'Child',    kr:'ì•„ì´',   key:'ìƒˆ ì‹œì‘Â·ìˆœìˆ˜Â·ì‘ìŒ',    type:'neutral'},
  {n:14, code:'Fox',      kr:'ì—¬ìš°',   key:'ì£¼ì˜Â·ê³„ì‚°Â·ìì˜',       type:'negative'},
  {n:15, code:'Bear',     kr:'ê³°',     key:'ì¬ì •Â·ê¶Œìœ„Â·ë³´í˜¸',       type:'neutral'},
  {n:16, code:'Stars',    kr:'ë³„',     key:'ë¹„ì „Â·í¬ë§Â·ì¸ì‚¬ì´íŠ¸',   type:'positive'},
  {n:17, code:'Stork',    kr:'í™©ìƒˆ',   key:'ë³€í™”Â·ì´ë™Â·ì—…ê·¸ë ˆì´ë“œ', type:'positive'},
  {n:18, code:'Dog',      kr:'ê°œ',     key:'ì‹ ë¢°Â·ìš°ì •Â·íŒŒíŠ¸ë„ˆ',     type:'positive'},
  {n:19, code:'Tower',    kr:'íƒ‘',     key:'ê¸°ê´€Â·ê±°ë¦¬ë‘ê¸°Â·êµ¬ì¡°',   type:'neutral'},
  {n:20, code:'Garden',   kr:'ì •ì›',   key:'ê³µê°œÂ·ëª¨ì„Â·í‰íŒ',       type:'neutral'},
  {n:21, code:'Mountain', kr:'ì‚°',     key:'ì¥ì• Â·ì§€ì—°Â·ì¥ë²½',       type:'negative'},
  {n:22, code:'Crossroad',kr:'ê°ˆë¦¼ê¸¸', key:'ì„ íƒÂ·ê²°ì •Â·ë¶„ê¸°',       type:'neutral'},
  {n:23, code:'Mice',     kr:'ì¥',     key:'ì†Œëª¨Â·ì†ì‹¤Â·ë¶ˆì•ˆ',       type:'negative'},
  {n:24, code:'Heart',    kr:'í•˜íŠ¸',   key:'ì‚¬ë‘Â·í˜¸ì˜Â·ê³µê°',       type:'positive'},
  {n:25, code:'Ring',     kr:'ë°˜ì§€',   key:'ê³„ì•½Â·ìˆœí™˜Â·ì•½ì†',       type:'positive'},
  {n:26, code:'Book',     kr:'ì±…',     key:'ë¹„ë°€Â·í•™ìŠµÂ·ìë£Œ',       type:'neutral'},
  {n:27, code:'Letter',   kr:'í¸ì§€',   key:'ë¬¸ì„œÂ·ë©”ì¼Â·ì¦ë¹™',       type:'neutral'},
  {n:28, code:'Man',      kr:'ë‚¨ì„±',   key:'í•µì‹¬ ì¸ë¬¼(ë‚¨ì„±)',      type:'neutral'},
  {n:29, code:'Woman',    kr:'ì—¬ì„±',   key:'í•µì‹¬ ì¸ë¬¼(ì—¬ì„±)',      type:'neutral'},
  {n:30, code:'Lily',     kr:'ë°±í•©',   key:'í‰í™”Â·ì„±ìˆ™Â·íœ´ì‹',       type:'positive'},
  {n:31, code:'Sun',      kr:'íƒœì–‘',   key:'ì„±ê³µÂ·í™œë ¥Â·ê°€ì‹œí™”',     type:'positive'},
  {n:32, code:'Moon',     kr:'ë‹¬',     key:'ê°ì •Â·ëª…ì˜ˆÂ·ì¸ì •',       type:'neutral'},
  {n:33, code:'Key',      kr:'ì—´ì‡ ',   key:'í•´ê²°Â·ì •ë‹µÂ·ëŒíŒŒ',       type:'positive'},
  {n:34, code:'Fish',     kr:'ë¬¼ê³ ê¸°', key:'ìì›Â·ê±°ë˜Â·íë¦„',       type:'positive'},
  {n:35, code:'Anchor',   kr:'ë‹»',     key:'ì•ˆì •Â·ê³ ì •Â·ì§€ì†ì„±',     type:'neutral'},
  {n:36, code:'Cross',    kr:'ì‹­ìê°€', key:'ë¬´ê²ŒÂ·ì‹œí—˜Â·ì±…ì„',       type:'negative'},
];
const byNum=new Map(CARDS.map(c=>[c.n,c]));
const src = n => `images/ë ˆë…¸ë¨¼ë“œ-${String(n).padStart(2,'0')}.png`;

/* ê³µí†µ ìš”ì†Œ */
const drawArea = document.getElementById('draw');
const sumBox   = document.getElementById('summary');
const qToggle  = document.getElementById('qToggle');
const qInput   = document.getElementById('qInput');
const qBox     = document.getElementById('questionBox');

qToggle.addEventListener('change',()=>{ qInput.style.display=qToggle.checked?'inline-block':'none'; if(!qToggle.checked) qInput.value=''; });

function mini(c){
  return `<article class="card-mini" data-tone="${c.type}">
    <span class="pin" aria-hidden="true"></span>
    <div class="row"><span class="chip">${c.n}</span><span class="chip">${c.code}</span></div>
    <div class="img"><img src="${src(c.n)}" alt="${c.n}. ${c.code}"></div>
    <h4>${c.n}. ${c.code} (${c.kr})</h4><p>${c.key}</p>
  </article>`;
}
function pick(n){const nums=[...Array(36).keys()].map(i=>i+1), out=[];while(out.length<n) out.push(nums.splice(Math.random()*nums.length|0,1)[0]);return out.map(x=>byNum.get(x))}
function showQuestion(){if(qToggle.checked&&qInput.value.trim()){qBox.style.display='inline-flex';qBox.innerHTML=`<strong>ì§ˆë¬¸:</strong> ${qInput.value.trim()}`;}else{qBox.style.display='none';qBox.textContent='';}}
function jumpToResult(){drawArea.scrollIntoView({block:'start',behavior:'instant'});} // ê²°ê³¼ê°€ í•­ìƒ í™”ë©´ ë§¨ ìœ„ì— ì˜¤ê²Œ

/* 1/3/5 */
document.getElementById('btn1').onclick=()=>{const cs=pick(1);drawArea.className='draw-result';drawArea.innerHTML=cs.map(mini).join('');showQuestion();sumBox.style.display='none';jumpToResult();}
document.getElementById('btn3').onclick=()=>{const cs=pick(3);drawArea.className='draw-result';drawArea.innerHTML=cs.map(mini).join('');showQuestion();sumBox.style.display='none';jumpToResult();}
document.getElementById('btn5').onclick=()=>{const cs=pick(5);drawArea.className='draw-result draw-5';drawArea.innerHTML=cs.map(mini).join('');showQuestion();fiveSummary(cs);jumpToResult();}

/* 5ì¹´ë“œ ì´í‰ */
function fiveSummary(cs){
  const pos=cs.filter(c=>c.type==='positive').length,neg=cs.filter(c=>c.type==='negative').length,neu=cs.length-pos-neg;
  let tone='ğŸŸ¢ ê· í˜•'; if(pos>neg)tone='ğŸ”µ ìš°í˜¸ì '; else if(neg>pos)tone='ğŸ”´ ì‹ ì¤‘';
  const bullets=[];
  if(cs.some(c=>[33,31,9].includes(c.n)))bullets.push('ê²°ê³¼ ê°€ì‹œí™”Â·í•´ê²°ì˜ ì‹¤ë§ˆë¦¬');
  if(cs.some(c=>[25,27].includes(c.n)))bullets.push('ê³„ì•½/ë¬¸ì„œÂ·ê³µì  ì˜ì—­ ì²´í¬');
  if(cs.some(c=>[21,10,8,7,6].includes(c.n)))bullets.push('ë¦¬ìŠ¤í¬ ê´€ë¦¬Â·ì¼ì • ì¡°ì •');
  sumBox.style.display='inline-flex';
  sumBox.innerHTML=`<strong>ì „ì²´ í†¤:</strong> ${tone} (ê¸ì • ${pos} / ë¶€ì • ${neg} / ì¤‘ë¦½ ${neu})<br>â€¢ ${bullets.join('<br>â€¢ ')||'í•µì‹¬ í¬ì¸íŠ¸ë¥¼ ìƒí™©ì— ë§ê²Œ ì ê²€í•˜ì„¸ìš”.'}`;
}

/* ì‹­ì â€” ìë™ ì¶•ì†Œ */
document.getElementById('btnCross').onclick=()=>{
  const [center,left,right,top,bottom]=pick(5);
  drawArea.className='draw-result';
  drawArea.innerHTML=`<div class="cross-wrap">
    <div class="cross-box" id="xScroll"><div class="cross-stage" id="xStage">
      <div class="cross-grid" id="xGrid">
        <div></div><div>${mini(top)}</div><div></div>
        <div>${mini(left)}</div><div>${mini(center)}</div><div>${mini(right)}</div>
        <div></div><div>${mini(bottom)}</div><div></div>
      </div></div></div></div>`;
  showQuestion(); sumBox.style.display='none'; jumpToResult();
  forceFitGrid(document.getElementById('xScroll'), document.getElementById('xStage'));
}

/* ê·¸ë‘ë”°ë¸”ë¡œ */
document.getElementById('btn9x4').onclick = ()=>grandTableau(9,4,false);
document.getElementById('btn8x4p4').onclick = ()=>grandTableau(8,4,true);

function grandTableau(cols, rows, essenceLast4){
  const order=pick(36).map(c=>c.n);
  const head=`<div class="gt-toolbar">ì¹´ë“œë¥¼ ëˆŒëŸ¬ <strong>í‚¤ ì¹´ë“œ</strong>ì˜ ì£¼ìœ„/ë‚˜ì´íŒ…ì„ í™•ì¸í•˜ì„¸ìš”.</div>`;
  const grid=`<div class="gt-scroll" id="gtScroll"><div class="gt-stage" id="gtStage">
    <div class="gt-grid" id="gtGrid" style="grid-template-columns:repeat(${cols},var(--card-w))">
      ${order.slice(0,cols*rows).map((n,i)=>{const c=byNum.get(n);return `<div class="card-mini gt-card" data-idx="${i}" data-num="${c.n}" data-tone="${c.type}">
        <span class="pin"></span>
        <div class="row"><span class="chip">${c.n}</span><span class="chip">${c.code}</span></div>
        <div class="img"><img src="${src(c.n)}" alt=""></div>
        <h4>${c.n}. ${c.code} (${c.kr})</h4><p>${c.key}</p></div>`}).join('')}
    </div></div></div>`;
  const ess = essenceLast4 ? `<div class="gt-toolbar"><strong>ì—ì„¼ìŠ¤ 4ì¥</strong></div>
    <div class="gt-scroll" id="gtEssScroll"><div class="gt-stage" id="gtEssStage">
      <div class="gt-grid" style="grid-template-columns:repeat(4,var(--card-w))">
        ${order.slice(cols*rows).map(n=>{const c=byNum.get(n);return `<div class="card-mini gt-card" data-tone="${c.type}">
          <span class="pin"></span>
          <div class="row"><span class="chip">${c.n}</span><span class="chip">${c.code}</span></div>
          <div class="img"><img src="${src(c.n)}" alt=""></div>
          <h4>${c.n}. ${c.code} (${c.kr})</h4><p>${c.key}</p></div>`}).join('')}
      </div></div></div>` : '';
  drawArea.className='draw-result';
  drawArea.innerHTML=`<div class="gt-wrap" id="gtWrap">${head}${grid}${ess}<div class="sidepanel" id="gtInfo">í‚¤ ì¹´ë“œë¥¼ ì„ íƒí•˜ë©´ í•´ì„ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div></div>`;
  sumBox.style.display='none'; showQuestion(); jumpToResult();

  const gridEl=document.getElementById('gtGrid');
  gridEl.querySelectorAll('.gt-card').forEach(el=>{
    el.addEventListener('click',()=>{
      const idx=+el.dataset.idx, rc=i=>({r:Math.floor(i/cols),c:i%cols}), toIdx=(r,c)=>(r>=0&&r<rows&&c>=0&&c<cols)?r*cols+c:-1;
      const p=rc(idx);
      const neigh=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].map(([dr,dc])=>toIdx(p.r+dr,p.c+dc)).filter(i=>i>=0);
      const kn=[[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]].map(([dr,dc])=>toIdx(p.r+dr,p.c+dc)).filter(i=>i>=0);
      const num=+el.dataset.num;
      const around=neigh.map(i=>+gridEl.querySelector(`.gt-card[data-idx="${i}"]`).dataset.num);
      const knight=kn.map(i=>+gridEl.querySelector(`.gt-card[data-idx="${i}"]`).dataset.num);
      const list=(t,a)=>`<div><strong>${t}</strong> â€” ${a.map(n=>`${n}.${byNum.get(n).code}`).join(', ')||'ì—†ìŒ'}</div>`;
      document.getElementById('gtInfo').innerHTML=`<strong>í‚¤ ì¹´ë“œ:</strong> ${num}. ${byNum.get(num).code} (${byNum.get(num).kr}) â€” ${byNum.get(num).key}<br>${list('ì£¼ìœ„ ì¹´ë“œ',around)}${list('ë‚˜ì´íŒ…',knight)}`;
    },{passive:true});
  });

  // ëª¨ë“  ì´ë¯¸ì§€ ë¡œë“œ í›„ ê³ ì • ì¶•ì†Œ
  const wrap=document.getElementById('gtWrap');
  const waitImgs = imgs => Promise.all(imgs.map(img=>img.complete?true:new Promise(r=>{img.addEventListener('load',r,{once:true});img.addEventListener('error',r,{once:true});})));
  waitImgs(Array.from(wrap.querySelectorAll('img'))).then(()=>{
    // ë‘ ë²ˆ ì¬í™•ì¸(ì£¼ì†Œì°½ ì• ë‹ˆë©”ì´ì…˜ ë³´ì •)
    const fitAll=()=>{
      forceFitGrid(document.getElementById('gtScroll'),document.getElementById('gtStage'));
      if(ess) forceFitGrid(document.getElementById('gtEssScroll'),document.getElementById('gtEssStage'));
    };
    fitAll(); requestAnimationFrame(fitAll); setTimeout(fitAll,120);
  });

  const onResize=()=>{forceFitGrid(document.getElementById('gtScroll'),document.getElementById('gtStage'));
                      if(ess) forceFitGrid(document.getElementById('gtEssScroll'),document.getElementById('gtEssStage'));};
  window.addEventListener('resize',onResize,{passive:true});
  window.visualViewport?.addEventListener('resize',onResize,{passive:true});
}

/* ===== ëª¨ë°”ì¼ í•œ í™”ë©´ ê°•ì œ ë§ì¶¤ (ê°œì„ íŒ) ===== */
function forceFitGrid(scrollEl, stageEl){
  if(!scrollEl||!stageEl) return;
  const isMobile = window.innerWidth <= 768;
  stageEl.style.transform='none';
  if(!isMobile){
    scrollEl.style.overflow='auto'; scrollEl.style.height=''; return;
  }
  // ê°€ìš© ì˜ì—­ ê³„ì‚°(ì£¼ì†Œì°½ í¬í•¨/ì œì™¸ ëª¨ë‘ ê³ ë ¤)
  const top = scrollEl.getBoundingClientRect().top;
  const vh1 = window.innerHeight, vh2 = (window.visualViewport?.height || vh1);
  const availH = Math.max(240, Math.min(vh1, vh2) - top - 12);
  const availW = scrollEl.clientWidth - 6;

  const needW = stageEl.scrollWidth;
  const needH = stageEl.scrollHeight;

  const scale = Math.min((availW-2)/needW, (availH-2)/needH, 1);
  stageEl.style.transform = `scale(${scale})`;
  scrollEl.style.height   = `${Math.ceil(needH*scale)+6}px`;
  scrollEl.style.overflow = 'hidden';
  scrollEl.style.webkitOverflowScrolling='touch';
}

/* === ê°¤ëŸ¬ë¦¬ === */
const toggleAll=document.getElementById('toggleAll');
const gallery=document.getElementById('gallery');
const filter=document.getElementById('filter');
toggleAll.onclick=()=>{const open=gallery.style.display!=='none';gallery.style.display=open?'none':'grid';if(!open) renderAll();}
filter.oninput=()=>renderAll(filter.value.trim().toLowerCase());
function renderAll(term=''){const list=CARDS.filter(c=>`${c.n} ${c.code} ${c.kr}`.toLowerCase().includes(term));
  gallery.innerHTML=list.map(c=>`
  <article class="gcard">
    <div class="row"><span class="chip">${c.n}</span><span class="chip">${c.code}</span></div>
    <div class="img"><img src="${src(c.n)}" alt=""></div>
    <h4>${c.n}. ${c.code} (${c.kr})</h4><p>${c.key}</p>
  </article>`).join('');
}
</script>
</body>
</html>