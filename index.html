<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>NAVI&HUI LENORMAND</title>
<style>
:root{
  --bg:#ede6ff; --panel:#f7f2ff; --panel2:#fff; --text:#3c2f62;
  --muted:#7e72a3; --ring:#c6b9e9; --shadow:0 6px 16px rgba(80,60,130,.18);
  --card-w:180px; --radius:12px;
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,sans-serif}
header{position:sticky;top:0;z-index:10;background:rgba(255,255,255,.7);backdrop-filter:blur(6px);
  border-bottom:1px solid var(--ring);padding:14px}
h1{margin:0;font-size:22px;color:#493c7b}
.container{max-width:1150px;margin:0 auto;padding:16px}
.btn{background:var(--panel);border:1px solid var(--ring);padding:8px 14px;border-radius:10px;cursor:pointer}
.card,.card-mini{background:var(--panel2);border:1px solid var(--ring);border-radius:var(--radius);box-shadow:var(--shadow);padding:10px;position:relative}
.badge{position:absolute;top:6px;right:6px;font-size:12px;padding:2px 6px;border-radius:999px;background:rgba(0,0,0,.25);color:#fff}
.img-box{width:100%;aspect-ratio:3/4;background:#fff;border-radius:10px;overflow:hidden;display:flex;align-items:center;justify-content:center}
.img-box img{width:100%;height:100%;object-fit:contain}
.card-positive{border:2px solid #4cc3ff}
.card-negative{border:2px solid #ff6b6b}
.card-neutral{border:2px solid #7df58e}

.drawbox{background:var(--panel);border:1px solid var(--ring);border-radius:14px;padding:14px;box-shadow:var(--shadow);margin-bottom:16px}
.draw-actions{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
.draw-result{display:grid;gap:12px;margin-top:12px}
.triple{grid-template-columns:repeat(3,1fr)}
.five{grid-template-columns:repeat(5,minmax(120px,1fr));overflow-x:auto}
#drawSummary{margin-top:10px;border:1px dashed var(--ring);padding:10px;border-radius:10px;background:var(--panel2);box-shadow:var(--shadow);color:var(--muted)}
.hidden{display:none}

/* â”€â”€ ì‹­ì ìŠ¤í”„ë ˆë“œ â”€â”€ */
.cross-wrap{
  --cross-min:140px;
  display:grid;
  grid-template-areas:
    ". top ."
    "left center right"
    ". bottom .";
  grid-template-columns: 1fr minmax(var(--cross-min), 1.2fr) 1fr;
  gap:12px; width:100%; max-width:760px; margin:0 auto;
}
.pos1{grid-area:top}.pos2{grid-area:left}.pos3{grid-area:center}.pos4{grid-area:right}.pos5{grid-area:bottom}

/* â”€â”€ ê·¸ë‘íƒ€ë¸”ë¡œ: ë°ìŠ¤í¬í†±=ìŠ¤í¬ë¡¤, ëª¨ë°”ì¼=ìë™ ì¶•ì†Œ â”€â”€ */
.gt-wrap{border:1px solid var(--ring);border-radius:14px;background:var(--panel2);box-shadow:var(--shadow);padding:10px}
.gt-toolbar{display:flex;gap:8px;align-items:center;margin:8px 0;color:var(--muted)}
.gt-scroll{overflow-x:auto;overflow-y:hidden;-webkit-overflow-scrolling:touch;touch-action:pan-x;scrollbar-width:thin;padding-bottom:8px}
.gt-scroll::-webkit-scrollbar{height:8px}
.gt-scroll::-webkit-scrollbar-thumb{background:#cbbaf3;border-radius:8px}
.gt-grid{display:inline-grid;width:max-content;gap:8px;justify-content:start}
.gt-card{width:var(--card-w)}
.gt-title{margin:6px 0 0;font-size:14px}
.hl{outline:3px solid #6b7bff;outline-offset:2px}
.sidepanel{margin-top:10px;border:1px dashed var(--ring);border-radius:10px;background:var(--panel2);box-shadow:var(--shadow);padding:10px}

/* ì¹´ë“œ ì „ì²´ ë³´ê¸° ê·¸ë¦¬ë“œ */
.grid{display:grid;gap:14px;padding:16px;grid-template-columns:repeat(auto-fill,minmax(220px,1fr))}

/* ë°˜ì‘í˜• */
@media (max-width:1100px){ :root{--card-w:160px} .triple{gap:10px} .cross-wrap{--cross-min:130px} }
@media (max-width:760px){  :root{--card-w:140px} .cross-wrap{--cross-min:120px} }
</style>
</head>
<body>
<header><h1>NAVI&amp;HUI LENORMAND</h1></header>

<div class="container">
  <section class="drawbox">
    <div class="draw-actions">
      <label style="font-size:12px"><input id="toggleQ" type="checkbox"> ì§ˆë¬¸ ì…ë ¥</label>
      <input id="inputQ" type="text" placeholder="ì§ˆë¬¸ (ì„ íƒ)" style="display:none">
      <button class="btn" id="btn1">ğŸƒ 1ì¹´ë“œ</button>
      <button class="btn" id="btn3">ğŸƒğŸƒğŸƒ 3ì¹´ë“œ</button>
      <button class="btn" id="btn5">ğŸƒğŸƒğŸƒğŸƒğŸƒ 5ì¹´ë“œ</button>
      <button class="btn" id="btnCross">âœš ì‹­ì</button>
      <button class="btn" id="btnGT94">ğŸ§© 9Ã—4</button>
      <button class="btn" id="btnGT84">ğŸ§© 8Ã—4+4</button>
    </div>
    <div id="qBox" style="margin-top:4px;color:var(--muted)"></div>
    <div id="drawArea" class="draw-result"></div>
    <div id="drawSummary" class="hidden"></div>
  </section>

  <button class="btn" id="toggleList">ğŸ“‚ ì¹´ë“œ ì „ì²´ ë³´ê¸°</button>
  <input id="search" type="search" placeholder="ì¹´ë“œ ê²€ìƒ‰ (ë²ˆí˜¸/ì´ë¦„)">
  <div id="grid" class="grid" style="display:none"></div>
</div>

<footer class="container" style="padding:40px 8px;text-align:center;color:var(--muted);border-top:1px solid var(--ring);margin-top:30px">
  ìë£Œ ì¶œì²˜: NAVI&amp;HUI LENORMAND ORACLE CARD<br>ì œì‘ : ë‚˜ë¹„ğŸ¦‹, ì›”í™ğŸŒ™
</footer>

<script>
/* ---------- ìœ í‹¸/ë°ì´í„° ---------- */
function src(num){const n=String(num).padStart(2,'0');return `images/ë ˆë…¸ë¨¼ë“œ-${n}.png`}
const T = (t)=> t==='positive'?'ğŸ”µ':(t==='negative'?'ğŸ”´':'ğŸŸ¢');
const C = (t)=> t==='positive'?'card-positive':(t==='negative'?'card-negative':'card-neutral');

const CARDS=[
  {num:1,code:"Rider",kr:"ê¸°ìˆ˜",key:"ì†Œì‹Â·ì´ë™",add:"ë¹ ë¥¸ ë³€í™”Â·ì—°ë½ ë„ì°©",type:"positive"},
  {num:2,code:"Clover",kr:"í´ë¡œë²„",key:"í–‰ìš´Â·ê¸°íšŒ",add:"ì§§ì€ ì°¬ìŠ¤Â·ì‹œë„ ì¢‹ìŒ",type:"positive"},
  {num:3,code:"Ship",kr:"ì„ ë°•",key:"ì—¬í–‰Â·í™•ì¥",add:"ê´€ê³„Â·í™˜ê²½ ë³€í™”",type:"neutral"},
  {num:4,code:"House",kr:"ì§‘",key:"ê°€ì •Â·ì•ˆì •",add:"ê¸°ë°˜ ë‹¤ì§€ê¸°",type:"neutral"},
  {num:5,code:"Tree",kr:"ë‚˜ë¬´",key:"ê±´ê°•Â·ì„±ì¥",add:"ì¥ê¸° ì„±ì¥Â·íšŒë³µ",type:"positive"},
  {num:6,code:"Cloud",kr:"êµ¬ë¦„",key:"í˜¼ë€Â·ë¶ˆí™•ì‹¤",add:"íŒë‹¨ ë³´ë¥˜Â·ì±™ê¸°ê¸°",type:"negative"},
  {num:7,code:"Snake",kr:"ë±€",key:"ìœ í˜¹Â·ê¸°ë§Œ",add:"ê²‰ê³¼ì† ë‹¤ë¦„Â·ì£¼ì˜",type:"negative"},
  {num:8,code:"Coffin",kr:"ê´€",key:"ëÂ·ì „í™˜",add:"ì •ë¦¬Â·ì¬ì¶œë°œ",type:"negative"},
  {num:9,code:"Bouquet",kr:"ë¶€ì¼€",key:"ê¸°ì¨Â·ì„ ë¬¼",add:"í˜¸ì˜ ìƒìŠ¹",type:"positive"},
  {num:10,code:"Scythe",kr:"ë‚«",key:"ë‹¨ì ˆÂ·ê²°ì •",add:"ë¹ ë¥¸ ì„ íƒ",type:"negative"},
  {num:11,code:"Whip",kr:"ì±„ì°",key:"ê°ˆë“±Â·ë°˜ë³µ",add:"ë£¨í”„ ëŠê¸°",type:"negative"},
  {num:12,code:"Bird",kr:"ìƒˆ",key:"ëŒ€í™”Â·ì†Œë¬¸",add:"ë§ ë§ì€ ì‹œê¸°",type:"neutral"},
  {num:13,code:"Child",kr:"ì•„ì´",key:"ìƒˆ ì‹œì‘Â·ìˆœìˆ˜",add:"ì‘ì§€ë§Œ ì„±ì¥ í¼",type:"positive"},
  {num:14,code:"Fox",kr:"ì—¬ìš°",key:"ì¼Â·ì˜ì‹¬",add:"ê³„ì•½Â·ì •ë³´ ì¬í™•ì¸",type:"neutral"},
  {num:15,code:"Bear",kr:"ê³°",key:"í˜Â·ë³´í˜¸",add:"í›„ì›Â·ë¦¬ë”ì‹­",type:"positive"},
  {num:16,code:"Stars",kr:"ë³„",key:"í¬ë§Â·ëª©í‘œ",add:"ë¹„ì „ ëª…í™•",type:"positive"},
  {num:17,code:"Stork",kr:"í™©ìƒˆ",key:"ë³€í™”Â·ê°œì„ ",add:"ìŠµê´€ ì—…ë°ì´íŠ¸",type:"positive"},
  {num:18,code:"Dog",kr:"ê°œ",key:"ì‹ ë¢°Â·ìš°ì •",add:"ë™ë§¹Â·íŒŒíŠ¸ë„ˆì‹­",type:"positive"},
  {num:19,code:"Tower",kr:"íƒ‘",key:"ì œë„Â·ë…ë¦½",add:"í™€ë¡œì„œê¸°",type:"neutral"},
  {num:20,code:"Garden",kr:"ì •ì›",key:"ëª¨ì„Â·ê³µê°œ",add:"ì¢‹ì€ í‰íŒ",type:"positive"},
  {num:21,code:"Mountain",kr:"ì‚°",key:"ì¥ì• Â·ì§€ì—°",add:"ì‹œê°„ í•„ìš”",type:"negative"},
  {num:22,code:"Crossroad",kr:"ê°ˆë¦¼ê¸¸",key:"ì„ íƒÂ·ê²°ì •",add:"ë°ì´í„° ë¹„êµ",type:"neutral"},
  {num:23,code:"Mice",kr:"ì¥",key:"ì†ì‹¤Â·ì†Œëª¨",add:"ë¯¸ì„¸ëˆ„ìˆ˜ ì ê²€",type:"negative"},
  {num:24,code:"Heart",kr:"í•˜íŠ¸",key:"ì‚¬ë‘Â·ê°ì •",add:"ê°ì • íšŒë³µ",type:"positive"},
  {num:25,code:"Ring",kr:"ë°˜ì§€",key:"ê³„ì•½Â·ìˆœí™˜",add:"ì¥ê¸° ì»¤ë°‹",type:"neutral"},
  {num:26,code:"Book",kr:"ì±…",key:"ë¹„ë°€Â·í•™ìŠµ",add:"ì •ë³´ ë¯¸ê³µê°œ",type:"neutral"},
  {num:27,code:"Letter",kr:"í¸ì§€",key:"ì—°ë½Â·ë¬¸ì„œ",add:"ì¦ê±°Â·í†µë³´",type:"positive"},
  {num:28,code:"Man",kr:"ë‚¨ì„±",key:"í•µì‹¬ ì¸ë¬¼",add:"ì¤‘ì‹¬ ë‚¨ì„±",type:"neutral"},
  {num:29,code:"Woman",kr:"ì—¬ì„±",key:"í•µì‹¬ ì¸ë¬¼",add:"ì¤‘ì‹¬ ì—¬ì„±",type:"neutral"},
  {num:30,code:"Lily",kr:"ë°±í•©",key:"í‰í™”Â·ì„±ìˆ™",add:"íœ´ì‹Â·í’ˆìœ„",type:"positive"},
  {num:31,code:"Sun",kr:"íƒœì–‘",key:"ì„±ê³µÂ·í™œë ¥",add:"ê¸ì • ê²°ê³¼",type:"positive"},
  {num:32,code:"Moon",kr:"ë‹¬",key:"ëª…ì˜ˆÂ·ê°ì •",add:"ê°ì • ë¦¬ë“¬",type:"positive"},
  {num:33,code:"Key",kr:"ì—´ì‡ ",key2:"í•´ê²°Â·ì •ë‹µ",add:"ëŒíŒŒêµ¬",type:"positive"},
  {num:34,code:"Fish",kr:"ë¬¼ê³ ê¸°",key:"ì¬ë¬¼Â·êµë¥˜",add:"êµë¥˜Â·ê±°ë˜ ì¦ê°€",type:"neutral"},
  {num:35,code:"Anchor",kr:"ë‹»",key:"ì•ˆì •Â·ê³ ì •",add:"ì§€ì†ì„±",type:"neutral"},
  {num:36,code:"Cross",kr:"ì‹­ìê°€",key:"ê³ ë‚œÂ·ì‹ ë…",add:"ì±…ì„Â·ë²„í‹°ê¸°",type:"negative"},
];
const byNum=new Map(CARDS.map(c=>[c.num,c]));

/* ---------- ëª©ë¡ ---------- */
const grid=document.getElementById('grid');
function renderList(list){
  grid.innerHTML='';
  list.forEach(c=>{
    const el=document.createElement('div');
    el.className=`card ${C(c.type)}`;
    el.innerHTML = `
      <span class="badge">${T(c.type)}</span>
      <div class="img-box"><img src="${src(c.num)}" alt="${c.code}"></div>
      <p><strong>${c.num}. ${c.code}</strong> (${c.kr})</p>
      <p><em>${c.key||c.key2}</em> â€” ${c.add}</p>`;
    grid.appendChild(el);
  });
}
renderList(CARDS);

let listOpen=false;
document.getElementById('toggleList').onclick=()=>{
  listOpen=!listOpen; grid.style.display=listOpen?'grid':'none';
  document.getElementById('toggleList').textContent=listOpen?'ğŸ“ ì¹´ë“œ ì ‘ê¸°':'ğŸ“‚ ì¹´ë“œ ì „ì²´ ë³´ê¸°';
};
document.getElementById('search').oninput=(e)=>{
  const v=e.target.value.toLowerCase();
  renderList(CARDS.filter(c=>c.code.toLowerCase().includes(v)||c.kr.includes(v)||(c.num+'')===v));
};

/* ì§ˆë¬¸ í† ê¸€ */
const toggleQ=document.getElementById('toggleQ');
const inputQ=document.getElementById('inputQ');
const qBox=document.getElementById('qBox');
toggleQ.onchange=()=>{inputQ.style.display=toggleQ.checked?'block':'none'; if(!toggleQ.checked){inputQ.value=''; qBox.textContent='';}};

/* ---------- 1/3/5 & ì´í‰ ---------- */
const drawArea=document.getElementById('drawArea'); const sumBox=document.getElementById('drawSummary');
function pickN(n){
  const arr=Array.from({length:n},()=>CARDS[Math.floor(Math.random()*CARDS.length)]);
  drawArea.className='draw-result'; drawArea.innerHTML='';
  if(n===3) drawArea.classList.add('triple'); if(n===5) drawArea.classList.add('five');
  if(toggleQ.checked && inputQ.value.trim()) qBox.textContent=`ì§ˆë¬¸: ${inputQ.value.trim()}`; else qBox.textContent='';
  arr.forEach(c=>{
    const d=document.createElement('div');
    d.className=`card-mini ${C(c.type)}`;
    d.innerHTML=`<span class="badge">${T(c.type)}</span>
      <div class="img-box"><img src="${src(c.num)}" alt="${c.code}"></div>
      <p><strong>${c.num}. ${c.code}</strong> (${c.kr})</p>
      <p><em>${c.key||c.key2}</em> â€” ${c.add}</p>`;
    drawArea.appendChild(d);
  });
  if(n===5){
    const pos=arr.filter(x=>x.type==='positive').length, neg=arr.filter(x=>x.type==='negative').length, neu=arr.length-pos-neg;
    let tone= pos>neg ? `ğŸ”µ ìš°í˜¸ì  (ê¸ì • ${pos}/ë¶€ì • ${neg}/ì¤‘ë¦½ ${neu})`
         : neg>pos ? `ğŸ”´ ì‹ ì¤‘ (ê¸ì • ${pos}/ë¶€ì • ${neg}/ì¤‘ë¦½ ${neu})`
         : `ğŸŸ¢ ê· í˜• (ê¸ì • ${pos}/ë¶€ì • ${neg}/ì¤‘ë¦½ ${neu})`;
    const has=n=>arr.some(x=>x.num===n);
    const pts=[];
    if(has(31)||has(33)||has(9)) pts.push('ì¶”ì§„ ì‹ í˜¸ â€” ê²°ê³¼ ê°€ì‹œí™”/í•´ê²° ì‹¤ë§ˆë¦¬');
    if(has(21)||has(10)||has(8)||has(7)||has(6)) pts.push('ë¦¬ìŠ¤í¬ â€” ì§€ì—°Â·ë‹¨ì ˆÂ·í˜¼ì„ , ì¼ì • ì¡°ì •');
    if(has(25)||has(27)||has(20)||has(19)) pts.push('ê³„ì•½Â·ë¬¸ì„œÂ·ê³µì  ì˜ì—­ ì²´í¬');
    if(has(34)||has(15)||has(35)) pts.push('ì¬ì •/ìì›/ì§€ì†ê°€ëŠ¥ì„± ì ê²€');
    let advice = neg>pos ? 'ë¦¬ìŠ¤í¬ ìš°ì„  ì •ë¦¬, ì •ë³´ ì¬í™•ì¸Â·ì¼ì • ì¡°ì • í›„ ì‘ì€ ì„±ê³¼ë¶€í„°.'
                         : pos>neg ? 'ë“¤ì–´ì˜¨ ì œì•ˆ/ì—°ë½ í™œìš©, ì†ë„ ë‚´ê¸°.' :
                                     'ë°ì´í„° ì •ë¦¬Â·ìš°ì„ ìˆœìœ„ ì„¸íŒ…ìœ¼ë¡œ í™•ì‹ ë„ í™•ë³´.';
    sumBox.innerHTML = `<strong>ì „ì²´ í†¤:</strong> ${tone}`+(pts.length?`<ul>${pts.map(p=>`<li>${p}</li>`).join('')}</ul>`:'')+`<div>${advice}</div>`;
    sumBox.classList.remove('hidden');
  }else sumBox.classList.add('hidden');
}
document.getElementById('btn1').onclick=()=>pickN(1);
document.getElementById('btn3').onclick=()=>pickN(3);
document.getElementById('btn5').onclick=()=>pickN(5);

/* ---------- ì‹­ì ìŠ¤í”„ë ˆë“œ ---------- */
document.getElementById('btnCross').onclick=()=>{
  const role=['í˜„ì¬/í•µì‹¬','ì¥ì• ','ë³¸ì§ˆ','ì¡°ì–¸','ê²°ê³¼'];
  const arr=Array.from({length:5},()=>CARDS[Math.floor(Math.random()*CARDS.length)]);
  drawArea.className='draw-result'; sumBox.classList.add('hidden');
  drawArea.innerHTML = `<div class="cross-wrap">
    ${arr.map((c,i)=>`
      <div class="card-mini ${C(c.type)} pos${i+1}">
        <span class="badge">${T(c.type)}</span>
        <div class="img-box"><img src="${src(c.num)}" alt="${c.code}"></div>
        <p><strong>${c.num}. ${c.code}</strong> (${c.kr})</p>
        <p><em>${role[i]}</em> â€” ${c.key||c.key2}, ${c.add}</p>
      </div>`).join('')}
  </div>`;
};

/* ---------- ê·¸ë‘íƒ€ë¸”ë¡œ (ëª¨ë°”ì¼ í™”ë©´ë§ì¶¤ í¬í•¨) ---------- */
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}

function fitToScreen(gtWrap){
  if (window.innerWidth > 768) return;
  const scroll = gtWrap.querySelector('.gt-scroll');
  const grid   = gtWrap.querySelector('.gt-grid');
  grid.style.transform = 'none';
  grid.style.transformOrigin = 'top left';
  scroll.style.height = '';
  const rect = scroll.getBoundingClientRect();
  const availW = scroll.clientWidth;
  const availH = Math.max(260, window.innerHeight - rect.top - 20);
  const needW = grid.scrollWidth;
  const needH = grid.scrollHeight;
  const scale = Math.min(availW / needW, availH / needH, 1);
  grid.style.transform = `scale(${scale})`;
  scroll.style.overflow = 'hidden';
  scroll.style.height = `${needH * scale + 8}px`;
}

function renderGT(order, cols, rows, essenceLast4=false){
  drawArea.className='draw-result'; sumBox.classList.add('hidden');
  const gridHTML = `
    <div class="gt-wrap" id="gtWrap">
      <div class="gt-toolbar">ì¹´ë“œë¥¼ ëˆŒëŸ¬ <strong>í‚¤ ì¹´ë“œ</strong>ì˜ <u>ì£¼ìœ„ ì¹´ë“œ</u>ì™€ <u>ë‚˜ì´íŒ…</u>ì„ í™•ì¸í•˜ì„¸ìš”.</div>
      <div class="gt-scroll">
        <div class="gt-grid" style="grid-template-columns:repeat(${cols}, var(--card-w))" id="gtGrid">
          ${order.slice(0, cols*rows).map((n,i)=>{const c=byNum.get(n);return `
            <div class="card-mini gt-card" data-idx="${i}" data-num="${c.num}">
              <div class="img-box"><img src="${src(c.num)}" alt="${c.code}"></div>
              <p class="gt-title"><strong>${c.num}. ${c.code}</strong> (${c.kr})</p>
            </div>`}).join('')}
        </div>
      </div>
      ${essenceLast4?`
      <div class="gt-toolbar">ì•„ë˜ëŠ” <strong>ì—ì„¼ìŠ¤ 4ì¥</strong> ìš”ì•½</div>
      <div class="gt-scroll" id="gtEssScroll">
        <div class="gt-grid" style="grid-template-columns:repeat(4, var(--card-w))" id="gtEss">
          ${order.slice(cols*rows).map(n=>{const c=byNum.get(n);return `
            <div class="card-mini gt-card">
              <div class="img-box"><img src="${src(c.num)}" alt="${c.code}"></div>
              <p class="gt-title"><strong>${c.num}. ${c.code}</strong> (${c.kr})</p>
            </div>`}).join('')}
        </div>
      </div>`:''}
      <div class="sidepanel" id="gtInfo">í‚¤ ì¹´ë“œë¥¼ ì„ íƒí•˜ë©´ í•´ì„ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
    </div>`;
  drawArea.innerHTML = gridHTML;

  const gridEl=document.getElementById('gtGrid');
  const info=document.getElementById('gtInfo');
  gridEl.querySelectorAll('.gt-card').forEach(el=>{
    el.onclick=()=>{
      gridEl.querySelectorAll('.gt-card').forEach(x=>x.classList.remove('hl'));
      el.classList.add('hl');

      const idx=+el.dataset.idx;
      const toRC=(i)=>({r:Math.floor(i/cols), c:i%cols});
      const toIdx=(r,c)=> (r>=0&&r<rows&&c>=0&&c<cols)? r*cols+c : -1;
      const pos=toRC(idx);

      const aroundIdx=[
        toIdx(pos.r-1,pos.c-1),toIdx(pos.r-1,pos.c),toIdx(pos.r-1,pos.c+1),
        toIdx(pos.r,pos.c-1),                   toIdx(pos.r,pos.c+1),
        toIdx(pos.r+1,pos.c-1),toIdx(pos.r+1,pos.c),toIdx(pos.r+1,pos.c+1)
      ].filter(i=>i>=0);
      const aroundCards=aroundIdx.map(i=>byNum.get(+gridEl.querySelector(`.gt-card[data-idx="${i}"]`).dataset.num));

      const knightD=[[ -2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]];
      const knightIdx=knightD.map(([dr,dc])=>toIdx(pos.r+dr,pos.c+dc)).filter(i=>i>=0);
      const knightCards=knightIdx.map(i=>byNum.get(+gridEl.querySelector(`.gt-card[data-idx="${i}"]`).dataset.num));

      const key = byNum.get(+el.dataset.num);
      const list = (title,arr)=> `<div><strong>${title} (${arr.length})</strong> â€” ${arr.map(c=>`${c.num}.${c.code}`).join(', ')||'ì—†ìŒ'}</div>`;
      info.innerHTML = `<strong>í‚¤ ì¹´ë“œ:</strong> ${key.num}. ${key.code} (${key.kr}) â€” <em>${key.key||key.key2}</em><br>
        ${list('ì£¼ìœ„ ì¹´ë“œ', aroundCards)}
        ${list('ë‚˜ì´íŒ…', knightCards)}`;
    };
  });

  const wrap = document.getElementById('gtWrap');
  fitToScreen(wrap);
  let rid;
  window.addEventListener('resize', ()=>{ clearTimeout(rid); rid=setTimeout(()=>fitToScreen(wrap),150); }, {passive:true});

  if(essenceLast4){
    const ess=order.slice(cols*rows).map(n=>byNum.get(n));
    const pos=ess.filter(x=>x.type==='positive').length, neg=ess.filter(x=>x.type==='negative').length;
    const tone= pos>neg?'ğŸ”µ ìš°í˜¸ì ':neg>pos?'ğŸ”´ ì‹ ì¤‘':'ğŸŸ¢ ê· í˜•';
    const pts=[];
    if(ess.some(x=>[31,33,9].includes(x.num))) pts.push('ê²°ê³¼ ê°€ì‹œí™”/í•´ê²°ì˜ ì‹¤ë§ˆë¦¬');
    if(ess.some(x=>[21,10,8,7,6].includes(x.num))) pts.push('ë¦¬ìŠ¤í¬ ê´€ë¦¬Â·ì¼ì • ì¡°ì •');
    document.getElementById('gtInfo').innerHTML = `<strong>ì—ì„¼ìŠ¤ 4ì¥ ì´í‰:</strong> ${tone}${pts.length?` â€” ${pts.join(' Â· ')}`:''}<br>
    í´ë¦­ìœ¼ë¡œ í‚¤ ì¹´ë“œ ì£¼ìœ„Â·ë‚˜ì´íŒ…ì„ í™•ì¸í•˜ì„¸ìš”.`;
  }
}

document.getElementById('btnGT94').onclick=()=>{
  const order=shuffle([...Array(36)].map((_,i)=>i+1));
  renderGT(order,9,4,false);
};
document.getElementById('btnGT84').onclick=()=>{
  const order=shuffle([...Array(36)].map((_,i)=>i+1));
  renderGT(order,8,4,true);
};
</script>
</body>
</html>