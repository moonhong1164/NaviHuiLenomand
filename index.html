<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>NAVI&HUI LENORMAND</title>
<style>
  :root{
    --bg:#efe8ff; --panel:#f6f1ff; --ink:#3a2e5f; --muted:#6b5a99; --ring:#d8c8ff;
    --card:#fff; --shadow:0 10px 30px rgba(82,55,155,.18); --chip:#ede3ff;
    --good:#2b82ff; --bad:#ff3b3b; --neutral:#19a65c; --card-w:210px;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,Apple SD Gothic Neo,Segoe UI,Roboto,Arial,sans-serif}
  header{position:sticky;top:0;z-index:10;background:linear-gradient(180deg,#f2eaffCC,#f2eaff80 70%,#0000);backdrop-filter:blur(6px)}
  .container{max-width:1100px;margin:0 auto;padding:16px}
  h1{margin:4px 0 0;font-size:26px;letter-spacing:.4px}

  .toolbar{background:var(--panel);border:1px solid var(--ring);border-radius:16px;box-shadow:var(--shadow);padding:14px;display:flex;flex-wrap:wrap;gap:10px;align-items:center}
  .btn{display:inline-flex;align-items:center;gap:6px;border-radius:12px;border:1px solid var(--ring);background:var(--card);padding:10px 14px;cursor:pointer;box-shadow:var(--shadow)}
  .chip{padding:4px 10px;border-radius:999px;background:var(--chip);border:1px solid var(--ring);color:var(--muted);font-size:12px}
  input[type="checkbox"]{transform:translateY(1px)}
  #question{display:none;width:100%;margin-top:6px;border:1px solid var(--ring);background:#fff;border-radius:10px;padding:10px 12px}

  /* ê³µí†µ ì¹´ë“œ */
  .card-mini{width:var(--card-w);background:var(--card);border:2px solid transparent;border-radius:18px;box-shadow:var(--shadow);padding:12px;position:relative}
  .card-mini h4{margin:6px 0 6px;font-size:18px}
  .img{width:100%;aspect-ratio:3/4;border-radius:14px;border:1px solid var(--ring);background:#e9e2ff;display:flex;align-items:center;justify-content:center;overflow:hidden}
  .img img{width:100%;height:100%;object-fit:contain} /* ì˜ë¦¼ ë°©ì§€ */
  .pin{position:absolute;top:8px;right:8px;width:16px;height:16px;border-radius:50%;box-shadow:0 2px 6px #0002}
  .tone-good{border-color:var(--good)} .tone-bad{border-color:var(--bad)} .tone-neutral{border-color:var(--neutral)}
  .tone-good .pin{background:var(--good)} .tone-bad .pin{background:var(--bad)} .tone-neutral .pin{background:var(--neutral)}
  .tone-good h4 b{color:var(--good)} .tone-bad h4 b{color:var(--bad)} .tone-neutral h4 b{color:var(--neutral)}

  /* ê²°ê³¼ ë¸”ë¡ */
  .draw{margin:14px 0}
  .cards{display:grid;gap:14px}
  .sidepanel{background:var(--panel);border:1px solid var(--ring);border-radius:14px;padding:12px;box-shadow:var(--shadow)}

  /* í™”ë©´-ë§ì¶¤ ìŠ¤ì¼€ì¼ëŸ¬ (3/5/ì‹­ì/ê·¸ë‘ë”°ë¸”ë¡œ ê³µí†µ) */
  .fitbox{border:1px solid var(--ring);border-radius:16px;background:var(--panel);padding:8px;overflow:hidden}
  .fitstage{transform-origin:top left;display:inline-block}

  /* 3/5 ê¸°ë³¸ ê·¸ë¦¬ë“œ (ìŠ¤ì¼€ì¼ ì „ ê°€ìƒ í¬ê¸°) */
  .g3{display:grid;grid-template-columns:repeat(3,var(--card-w));gap:12px;justify-content:center}
  .g5{display:grid;grid-template-columns:repeat(5,var(--card-w));gap:12px;justify-content:center}

  /* ì‹­ì: ì •í™•í•œ ì‹­ì ë°°ì¹˜ */
  .cross-grid{display:grid;grid-template-columns:repeat(3,var(--card-w));grid-template-rows:repeat(3,auto);gap:12px;justify-content:center}
  .pos-top{grid-column:2;grid-row:1}
  .pos-left{grid-column:1;grid-row:2}
  .pos-center{grid-column:2;grid-row:2}
  .pos-right{grid-column:3;grid-row:2}
  .pos-bottom{grid-column:2;grid-row:3}

  /* ê·¸ë‘ë”°ë¸”ë¡œ */
  .gt-wrap{display:grid;grid-template-columns:1fr 300px;gap:14px}
  .gt-toolbar{background:var(--panel);border:1px solid var(--ring);border-radius:12px;padding:10px 12px;color:var(--muted);margin-bottom:8px}
  .gt-grid{display:grid;gap:8px}
  @media (max-width:900px){ .gt-wrap{grid-template-columns:1fr} }
</style>
</head>
<body>
<header><div class="container"><h1>NAVI&HUI LENORMAND</h1></div></header>

<main class="container">
  <div class="toolbar">
    <label class="chip"><input type="checkbox" id="askToggle"> ì§ˆë¬¸ ì…ë ¥</label>
    <button class="btn" id="btn1">ğŸƒ 1ì¹´ë“œ</button>
    <button class="btn" id="btn3">ğŸƒğŸƒğŸƒ 3ì¹´ë“œ</button>
    <button class="btn" id="btn5">ğŸƒğŸƒğŸƒğŸƒğŸƒ 5ì¹´ë“œ</button>
    <button class="btn" id="btnCross">â• ì‹­ì</button>
    <button class="btn" id="btnGT94">ğŸ§© 9Ã—4</button>
    <button class="btn" id="btnGT844">ğŸ§© 8Ã—4+4</button>
    <input id="question" type="text" placeholder="ì§ˆë¬¸ì„ ì ì–´ ì£¼ì„¸ìš” (ì„ íƒ)">
  </div>

  <section class="draw">
    <div id="result" class="cards"></div>
    <div id="summary" class="sidepanel" style="display:none"></div>
  </section>

  <div style="margin:8px 0"><button class="btn" id="btnAll">ğŸ“ ì¹´ë“œ ì „ì²´ ë³´ê¸°</button></div>
  <div id="allWrap" style="display:none">
    <div id="allGrid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px"></div>
  </div>

  <footer style="margin:30px 0 50px;text-align:center;color:var(--muted)">ì œì‘ : ë‚˜ë¹„ğŸ¦‹, ì›”í™ğŸŒ™</footer>
</main>

<script>
/* ===== ì¹´ë“œ ë°ì´í„° (ìš”ì•½) ===== */
const CARDS=(()=>{const D=[
  [1,'Rider','ê¸°ìˆ˜','ì†Œì‹Â·ì†ë„Â·ë„ì°©','neutral'],
  [2,'Clover','í´ë¡œë²„','í–‰ìš´Â·ê¸°íšŒÂ·ì§§ì€ í˜¸ì¬','positive'],
  [3,'Ship','ì„ ë°•','ì´ë™Â·í™•ì¥Â·ê±°ë¦¬','neutral'],
  [4,'House','ì§‘','ì•ˆì •Â·ê°€ì •Â·ê¸°ë°˜','positive'],
  [5,'Tree','ë‚˜ë¬´','ê±´ê°•Â·ì„±ì¥Â·ì‹œê°„','neutral'],
  [6,'Cloud','êµ¬ë¦„','í˜¼ë€Â·ë¶ˆí™•ì‹¤Â·íŒë‹¨ë³´ë¥˜','negative'],
  [7,'Snake','ë±€','ìœ í˜¹Â·ì¥ì• Â·ìš°íšŒ','negative'],
  [8,'Coffin','ê´€','ëÂ·ì •ë¦¬Â·ì „í™˜','negative'],
  [9,'Bouquet','ë¶€ì¼€','ê¸°ì¨Â·ì„ ë¬¼Â·í˜¸ì˜','positive'],
  [10,'Scythe','ë‚«','ë‹¨ì ˆÂ·ê²°ë‹¨Â·ìˆ˜ìˆ ','negative'],
  [11,'Whip','ì±„ì°','ê°ˆë“±Â·ë°˜ë³µÂ·ë£¨í”„','negative'],
  [12,'Bird','ìƒˆ','ëŒ€í™”Â·ì†Œí†µÂ·ê¸´ì¥','neutral'],
  [13,'Child','ì•„ì´','ìƒˆì‹œì‘Â·ìˆœìˆ˜Â·ì‘ìŒ','positive'],
  [14,'Fox','ì—¬ìš°','ì˜ì‹¬Â·ì¼Â·ì˜ë¦¬í•¨','neutral'],
  [15,'Bear','ê³°','ê¶Œìœ„Â·ì¬ì •Â·ë³´í˜¸','neutral'],
  [16,'Stars','ë³„','ë¹„ì „Â·ì˜ê°Â·ëª…í™•','positive'],
  [17,'Stork','í™©ìƒˆ','ë³€í™”Â·ì´ë™Â·ì—…ê·¸ë ˆì´ë“œ','positive'],
  [18,'Dog','ê°œ','ì‹ ë¢°Â·ìš°ì •Â·íŒŒíŠ¸ë„ˆ','positive'],
  [19,'Tower','íƒ‘','ì œë„Â·ê±°ë¦¬ê°Â·ìœ„ê³„','neutral'],
  [20,'Garden','ì •ì›','ê³µê°œÂ·ë„¤íŠ¸ì›Œí¬Â·ëª¨ì„','neutral'],
  [21,'Mountain','ì‚°','ì¥ì• ë¬¼Â·ì§€ì—°Â·ë²½','negative'],
  [22,'Crossroad','ê°ˆë¦¼ê¸¸','ì„ íƒÂ·ê²°ì •Â·ë¶„ê¸°','neutral'],
  [23,'Mice','ì¥','ì†Œëª¨Â·ë¶ˆì•ˆÂ·ëˆ„ìˆ˜','negative'],
  [24,'Heart','í•˜íŠ¸','ì‚¬ë‘Â·ì—´ì •Â·í˜¸ê°','positive'],
  [25,'Ring','ë°˜ì§€','ê³„ì•½Â·ìˆœí™˜Â·ì•½ì†','positive'],
  [26,'Book','ì±…','ë¹„ë°€Â·í•™ìŠµÂ·ë¬¸ì„œ','neutral'],
  [27,'Letter','í¸ì§€','ì—°ë½Â·ë¬¸ì„œÂ·ì•Œë¦¼','neutral'],
  [28,'Man','ë‚¨ì„±','í•µì‹¬ ì¸ë¬¼(ë‚¨)','neutral'],
  [29,'Woman','ì—¬ì„±','í•µì‹¬ ì¸ë¬¼(ì—¬)','neutral'],
  [30,'Lily','ë°±í•©','í‰í™”Â·ì„±ìˆ™Â·íœ´ì‹','positive'],
  [31,'Sun','íƒœì–‘','ì„±ê³µÂ·í™œë ¥Â·ì„±ê³¼','positive'],
  [32,'Moon','ë‹¬','ê°ì •Â·ëª…ì˜ˆÂ·ë¦¬ë“¬','neutral'],
  [33,'Key','ì—´ì‡ ','í•´ê²°Â·ì •ë‹µÂ·ëŒíŒŒêµ¬','positive'],
  [34,'Fish','ë¬¼ê³ ê¸°','ì¬ë¬¼Â·ê±°ë˜Â·íë¦„','neutral'],
  [35,'Anchor','ë‹»','ì•ˆì •Â·ê³ ì •Â·ì§€ì†ì„±','positive'],
  [36,'Cross','ì‹­ìê°€','ê³ ë‚œÂ·ì±…ì„Â·ë²„í‹°ê¸°','negative'],
];return D.map(([n,code,kr,key,type])=>({n,code,kr,key,type}));})();
const byNum=new Map(CARDS.map(c=>[c.n,c]));
const src=n=>`images/ë ˆë…¸ë¨¼ë“œ-${String(n).padStart(2,'0')}.png`;
const $=s=>document.querySelector(s);
const result=$("#result"), summary=$("#summary");
const askToggle=$("#askToggle"), question=$("#question");
askToggle.addEventListener('change',()=>{question.style.display=askToggle.checked?'block':'none'});

/* ê³µìš© ì¹´ë“œ DOM */
function mini(c){
  const tone = c.type==='positive'?'tone-good':(c.type==='negative'?'tone-bad':'tone-neutral');
  const tag  = c.type==='positive'?'ğŸ”µ ê¸ì •':(c.type==='negative'?'ğŸ”´ ë¶€ì •':'ğŸŸ¢ ì¤‘ë¦½');
  return `<article class="card-mini ${tone}">
    <span class="pin"></span>
    <div class="img"><img src="${src(c.n)}" alt=""></div>
    <h4><b>${c.n}. ${c.code}</b> (${c.kr})</h4>
    <p>${c.key}</p>
    <div class="chip">${tag}</div>
  </article>`;
}

/* í™”ë©´-ë§ì¶¤ ìŠ¤ì¼€ì¼ëŸ¬ */
function forceFit(container, stage, pad=0.98){
  if(!container||!stage) return;
  stage.style.transform='none';
  const mobile = window.innerWidth<=768;
  if(!mobile){ container.style.height=''; container.style.overflow='auto'; return; }
  const top = container.getBoundingClientRect().top;
  const vh  = Math.min(window.innerHeight, window.visualViewport?.height||window.innerHeight);
  const availH = Math.max(220, vh - top - 10);
  const availW = container.clientWidth - 6;
  const needW = stage.scrollWidth, needH = stage.scrollHeight;
  const scale = Math.min(availW/needW, availH/needH, 1) * pad;
  stage.style.transform = `scale(${scale})`;
  container.style.height = `${Math.ceil(needH*scale)+6}px`;
  container.style.overflow='hidden';
}

/* ë„ìš°ë¯¸ */
function picked(n){
  const used=new Set(), arr=[];
  while(arr.length<n){
    const c=CARDS[Math.floor(Math.random()*CARDS.length)];
    if(!used.has(c.n)){used.add(c.n);arr.push(c);}
  }
  return arr;
}
function showQ(){
  if(askToggle.checked && question.value.trim()){
    const chip = `<div class="chip" style="margin:6px 0">ì§ˆë¬¸: ${question.value.trim()}</div>`;
    result.insertAdjacentHTML('afterbegin', chip);
  }
}

/* 1/3/5ì¹´ë“œ: ëª¨ë‘ í•œ í™”ë©´ ìë™ ì¶•ì†Œ */
function draw1(){
  const cs=picked(1);
  result.innerHTML = `<div class="fitbox"><div class="fitstage" id="fit1">
      <div class="g3" style="grid-template-columns:repeat(1,var(--card-w))">${cs.map(mini).join('')}</div>
    </div></div>`;
  summary.style.display='none'; showQ();
  const c=$('.fitbox'), s=$('#fit1'); fitAfterImages(c,s);
}
function draw3(){
  const cs=picked(3);
  result.innerHTML = `<div class="fitbox"><div class="fitstage" id="fit3">
      <div class="g3">${cs.map(mini).join('')}</div>
    </div></div>`;
  summary.style.display='none'; showQ();
  const c=$('.fitbox'), s=$('#fit3'); fitAfterImages(c,s);
}
function draw5(){
  const cs=picked(5);
  result.innerHTML = `<div class="fitbox"><div class="fitstage" id="fit5">
      <div class="g5">${cs.map(mini).join('')}</div>
    </div></div>`;
  // ê°„ë‹¨ ì´í‰
  const pos=cs.filter(v=>v.type==='positive').length, neg=cs.filter(v=>v.type==='negative').length, neu=5-pos-neg;
  const tone = pos>neg?'ğŸ”µ ìš°í˜¸ì ':(neg>pos?'ğŸ”´ ê²½ê³„':'ğŸŸ¢ ì¤‘ë¦½');
  summary.style.display='block';
  summary.innerHTML = `<b>ì „ì²´ í†¤:</b> ${tone} <span class="chip">ê¸ì • ${pos} / ë¶€ì • ${neg} / ì¤‘ë¦½ ${neu}</span>`;
  showQ();
  const c=$('.fitbox'), s=$('#fit5'); fitAfterImages(c,s);
}

/* ì‹­ì: ì‹­ìí˜• ì •í™• ë°°ì¹˜ + í•œ í™”ë©´ ì¶•ì†Œ */
function drawCross(){
  const cs=picked(5); // [ìƒ,ì¢Œ,ì¤‘,ìš°,í•˜]
  result.innerHTML = `<div class="fitbox"><div class="fitstage" id="fitX">
    <div class="cross-grid">
      <div class="pos-top">${mini(cs[0])}</div>
      <div class="pos-left">${mini(cs[1])}</div>
      <div class="pos-center">${mini(cs[2])}</div>
      <div class="pos-right">${mini(cs[3])}</div>
      <div class="pos-bottom">${mini(cs[4])}</div>
    </div>
  </div></div>`;
  summary.style.display='none'; showQ();
  fitAfterImages($('.fitbox'), $('#fitX'));
}

/* ê·¸ë‘ë”°ë¸”ë¡œ (ê¸°ì¡´: ëª¨ë°”ì¼ ìë™ ì¶•ì†Œ ìœ ì§€) */
function grandTableau(cols,rows,ess){
  const order = picked(36).map(c=>c.n);
  const grid = `<div class="gt-toolbar">í‚¤ ì¹´ë“œë¥¼ ëˆ„ë¥´ë©´ ì£¼ìœ„/ë‚˜ì´íŒ…ì´ í‘œì‹œë©ë‹ˆë‹¤.</div>
    <div class="fitbox"><div class="fitstage" id="gtStage">
      <div class="gt-grid" style="grid-template-columns:repeat(${cols},var(--card-w))">
        ${order.slice(0,cols*rows).map((n,i)=>{const c=byNum.get(n);return`
          <div class="card-mini ${c.type==='positive'?'tone-good':(c.type==='negative'?'tone-bad':'tone-neutral')} gt" data-idx="${i}" data-num="${c.n}">
            <span class="pin"></span>
            <div class="img"><img src="${src(c.n)}" alt=""></div>
            <h4><b>${c.n}. ${c.code}</b> (${c.kr})</h4>
            <p>${c.key}</p>
          </div>`}).join('')}
      </div>
    </div></div>`;
  const ess4 = ess ? `<div class="gt-toolbar"><b>ì—ì„¼ìŠ¤ 4ì¥</b></div>
    <div class="fitbox"><div class="fitstage" id="gtEss">
      <div class="gt-grid" style="grid-template-columns:repeat(4,var(--card-w))">
        ${order.slice(cols*rows).map(n=>{const c=byNum.get(n);return`
          <div class="card-mini ${c.type==='positive'?'tone-good':(c.type==='negative'?'tone-bad':'tone-neutral')}">
            <span class="pin"></span>
            <div class="img"><img src="${src(c.n)}" alt=""></div>
            <h4><b>${c.n}. ${c.code}</b> (${c.kr})</h4>
            <p>${c.key}</p>
          </div>`}).join('')}
      </div>
    </div></div>` : '';
  result.innerHTML = `<div class="gt-wrap">
    <div>${grid}${ess4}</div>
    <div class="sidepanel" id="gtInfo">í‚¤ ì¹´ë“œë¥¼ ì„ íƒí•˜ë©´ í•´ì„ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
  </div>`;
  summary.style.display='none'; showQ();

  // í‚¤ ì¹´ë“œ ì •ë³´
  const gridEl=document.querySelector('.gt-grid');
  gridEl.querySelectorAll('.gt').forEach(el=>{
    el.addEventListener('click',()=>{
      const idx=+el.dataset.idx, rc=i=>({r:Math.floor(i/cols),c:i%cols}), toIdx=(r,c)=>(r>=0&&r<rows&&c>=0&&c<cols)?r*cols+c:-1;
      const p=rc(idx);
      const neigh=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]].map(([dr,dc])=>toIdx(p.r+dr,p.c+dc)).filter(i=>i>=0);
      const kn=[[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]].map(([dr,dc])=>toIdx(p.r+dr,p.c+dc)).filter(i=>i>=0);
      const getNum=i=>+gridEl.querySelector(`.gt[data-idx="${i}"]`).dataset.num;
      const around=neigh.map(getNum), knight=kn.map(getNum);
      const num=+el.dataset.num, c=byNum.get(num);
      const fmt=a=>a.map(n=>`${n}.${byNum.get(n).code}`).join(', ')||'ì—†ìŒ';
      $("#gtInfo").innerHTML = `<b>í‚¤ ì¹´ë“œ:</b> ${num}. ${c.code} (${c.kr}) â€” ${c.key}<br>
      <b>ì£¼ìœ„ ì¹´ë“œ:</b> ${fmt(around)}<br><b>ë‚˜ì´íŒ…:</b> ${fmt(knight)}`;
    },{passive:true});
  });

  // í™”ë©´ ë§ì¶¤
  fitAfterImages(document.querySelectorAll('.fitbox')[0], $('#gtStage'));
  if(ess) fitAfterImages(document.querySelectorAll('.fitbox')[1], $('#gtEss'));
}

/* ì´ë¯¸ì§€ ë¡œë”© í›„ ë§ì¶¤ */
function fitAfterImages(container, stage){
  const imgs=[...stage.querySelectorAll('img')];
  const done = Promise.all(imgs.map(im=>im.complete?true:new Promise(res=>{im.addEventListener('load',res,{once:true});im.addEventListener('error',res,{once:true});})));
  const fit=()=>forceFit(container,stage,0.98);
  done.then(()=>{fit(); requestAnimationFrame(fit); setTimeout(fit,120);});
  addEventListener('resize',fit,{passive:true});
  window.visualViewport?.addEventListener('resize',fit,{passive:true});
}

/* ì „ì²´ ë³´ê¸° */
function renderAll(){
  const box=$("#allWrap"), grid=$("#allGrid");
  box.style.display = box.style.display==='none' ? 'block' : 'none';
  if(box.style.display==='none') return;
  grid.innerHTML = CARDS.map(mini).join('');
}

/* ì´ë²¤íŠ¸ ë°”ì¸ë”© */
$("#btn1").onclick=draw1;
$("#btn3").onclick=draw3;        // ê°€ë¡œ 3, í•œ í™”ë©´ ë§ì¶¤
$("#btn5").onclick=draw5;        // ê°€ë¡œ 5, í•œ í™”ë©´ ë§ì¶¤
$("#btnCross").onclick=drawCross;/* ì‹­ì ì •í™• ë°°ì¹˜ + í•œ í™”ë©´ ë§ì¶¤ */
$("#btnGT94").onclick=()=>grandTableau(9,4,false);
$("#btnGT844").onclick=()=>grandTableau(8,4,true);
$("#btnAll").onclick=renderAll;

/* ì´ˆê¸° ë¯¸ë¦¬ë³´ê¸° */
draw3();
</script>
</body>
</html>