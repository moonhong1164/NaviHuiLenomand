<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>NAVI&HUI LENORMAND</title>
<style>
:root{
  --bg:#efe7ff;               /* ì—°ë³´ë¼ ë°°ê²½ */
  --panel:#f7f2ff;            /* ì¹´ë“œ/íŒ¨ë„ */
  --ink:#2a2540;
  --muted:#6f6590;
  --brand:#6f55cc;
  --ring:#dfd3ff;
  --shadow:0 10px 30px rgba(0,0,0,.08);

  --good:#3b82f6;   /* ğŸ”µ ê¸ì • */
  --bad:#ef4444;    /* ğŸ”´ ë¶€ì • */
  --mid:#10b981;    /* ğŸŸ¢ ì¤‘ë¦½ */

  --card-w:160px;   /* ìŠ¤ì¼€ì¼ ê¸°ì¤€ ì¹´ë“œ í­ (ê·¸ë‘íƒ€ë¸”ë¡œ ì¶•ì†Œìš©) */
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--ink);font-family:ui-sans-serif,system-ui,apple sd gothic neo,Segoe UI,Roboto,Apple Color Emoji,Noto Color Emoji,Segoe UI Emoji}
header{position:sticky;top:0;z-index:20;background:linear-gradient(180deg,#fff,rgba(255,255,255,.6));backdrop-filter:saturate(140%) blur(6px);border-bottom:1px solid var(--ring)}
.container{max-width:1100px;margin:0 auto;padding:16px}
h1{margin:0;font-size:28px;letter-spacing:.5px;color:#3c2a7a}

.toolbar{background:var(--panel);border:1px solid var(--ring);border-radius:16px;box-shadow:var(--shadow);padding:12px;display:flex;flex-wrap:wrap;gap:10px;align-items:center}
.btn{display:inline-flex;align-items:center;gap:6px;background:#fff;border:1px solid var(--ring);border-radius:12px;padding:8px 12px;cursor:pointer}
.btn:active{transform:translateY(1px)}
.badge{display:inline-flex;align-items:center;gap:6px;border-radius:999px;padding:4px 10px;border:1px solid var(--ring);background:#fff;color:var(--muted)}
input[type="search"]{width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--ring);background:#fff}

.grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fill,minmax(220px,1fr))}
.card-mini{background:#fff;border:1px solid var(--ring);border-radius:16px;box-shadow:var(--shadow);padding:10px;position:relative}
.card-mini .img{background:var(--panel);border:1px solid var(--ring);border-radius:12px;display:flex;align-items:center;justify-content:center;overflow:hidden}
.card-mini .img img{width:100%;height:auto;display:block}
.card-mini h4{margin:10px 4px 6px;font-size:18px}
.card-mini p{margin:0 4px 10px;color:var(--muted)}
.pin{position:absolute;right:10px;top:10px;width:14px;height:14px;border-radius:999px;box-shadow:0 0 0 3px #fff}
.tone{display:inline-flex;align-items:center;gap:6px;border-radius:999px;padding:4px 9px;font-size:13px;margin:6px 4px 0}
.t-good{background:rgba(59,130,246,.12);color:var(--good);border:1px solid rgba(59,130,246,.35)}
.t-bad{background:rgba(239,68,68,.12);color:var(--bad);border:1px solid rgba(239,68,68,.35)}
.t-mid{background:rgba(16,185,129,.12);color:var(--mid);border:1px solid rgba(16,185,129,.35)}
.pin.good{background:var(--good)} .pin.bad{background:var(--bad)} .pin.mid{background:var(--mid)}

.result{margin-top:12px}
.row-3, .row-5{display:grid;gap:12px}
.row-3{grid-template-columns:repeat(3,minmax(0,1fr))}
.row-5{grid-template-columns:repeat(5,minmax(0,1fr))}
@media(max-width:720px){
  .row-3{grid-template-columns:repeat(3,minmax(0,1fr))}
  .row-5{grid-template-columns:repeat(5,minmax(0,1fr))}
}
/* ê°€ë¡œ í•œ í™”ë©´ ìë™ ì¶•ì†Œ ì»¨í…Œì´ë„ˆ */
.fitbox{position:relative;width:100%;overflow:hidden}
.fitstage{transform-origin:top left;display:inline-block}

/* ê·¸ë‘íƒ€ë¸”ë¡œ ì „ìš© */
.gt-wrap{display:grid;grid-template-columns:1fr 310px;gap:12px}
@media(max-width:980px){.gt-wrap{grid-template-columns:1fr}}
.gt-toolbar{margin:4px 0 8px;color:var(--muted)}
.gt-grid{display:grid}
.sidepanel{background:#fff;border:1px solid var(--ring);border-radius:16px;padding:12px;box-shadow:var(--shadow)}

.sumbox{margin-top:12px;background:#fff;border:1px solid var(--ring);border-radius:16px;box-shadow:var(--shadow);padding:12px}
.sum-title{font-weight:700;margin-bottom:6px}
.sum-note{color:var(--muted)}
.sum-list{margin:8px 0 10px 18px}
.sum-advice{padding-top:6px;border-top:1px dashed #e2d7ff}
footer{margin:24px 0 30px;color:var(--muted);text-align:center}
</style>
</head>
<body>
<header><div class="container"><h1>NAVI&HUI LENORMAND</h1></div></header>

<main class="container">
  <section class="toolbar">
    <label class="badge"><input id="toggleQ" type="checkbox"> ì§ˆë¬¸ ì…ë ¥</label>
    <input id="qInput" type="search" placeholder="ì§ˆë¬¸ (ì„ íƒ)" style="display:none;max-width:280px">
    <button class="btn" id="btn1">ğŸƒ 1ì¹´ë“œ</button>
    <button class="btn" id="btn3">ğŸƒğŸƒğŸƒ 3ì¹´ë“œ</button>
    <button class="btn" id="btn5">ğŸƒğŸƒğŸƒğŸƒğŸƒ 5ì¹´ë“œ</button>
    <button class="btn" id="btnCross">â• ì‹­ì</button>
    <button class="btn" id="btnGT94">ğŸ§© 9Ã—4</button>
    <button class="btn" id="btnGT84">ğŸ§© 8Ã—4+4</button>
  </section>

  <div id="questionBox" class="sumbox" style="display:none"></div>

  <section id="result" class="result"></section>
  <div id="summary"></div>

  <div style="margin-top:14px">
    <button class="btn" id="btnAll">ğŸ“ ì¹´ë“œ ì „ì²´ ë³´ê¸°</button>
  </div>
  <div id="all" class="grid" style="display:none;margin-top:12px"></div>
</main>

<footer>ì œì‘ : ë‚˜ë¹„ğŸ¦‹, ì›”í™ğŸŒ™</footer>

<script>
// ------------------ ë°ì´í„° ------------------
// ë²ˆí˜¸, ì˜ë¬¸, í•œê¸€, í•µì‹¬ í‚¤ì›Œë“œ, ì„±í–¥(type): positive|negative|neutral
const CARDS = [
  [1,'Rider','ê¸°ìˆ˜','ì†Œì‹Â·ì†ë„Â·ì‹œì‘','positive'],
  [2,'Clover','í´ë¡œë²„','í–‰ìš´Â·ê¸°íšŒÂ·ì§§ì€ í˜¸ì¬','positive'],
  [3,'Ship','ì„ ë°•','ì—¬í–‰Â·í™•ì¥Â·ë³€í™”','neutral'],
  [4,'House','ì§‘','ê°€ì •Â·ì•ˆì •Â·ê¸°ë°˜','positive'],
  [5,'Tree','ë‚˜ë¬´','ê±´ê°•Â·ì„±ì¥Â·ì¥ê¸°','neutral'],
  [6,'Cloud','êµ¬ë¦„','í˜¼ë€Â·ë¶ˆí™•ì‹¤Â·íŒë‹¨ë³´ë¥˜','negative'],
  [7,'Snake','ë±€','ì¥ì• Â·ìœ í˜¹Â·ê¸°ë§Œ','negative'],
  [8,'Coffin','ê´€','ëÂ·ì „í™˜Â·ì •ë¦¬','negative'],
  [9,'Bouquet','ë¶€ì¼€','ê¸°ì¨Â·ì„ ë¬¼Â·í˜¸ì˜','positive'],
  [10,'Scythe','ë‚«','ì ˆë‹¨Â·ê²°ë‹¨Â·ê¸‰ë³€','negative'],
  [11,'Whip','ì±„ì°','ê°ˆë“±Â·ë°˜ë³µÂ·ë£¨í”„','negative'],
  [12,'Bird','ìƒˆ','ëŒ€í™”Â·ì—°ë½Â·ë¶ˆì•ˆ','neutral'],
  [13,'Child','ì•„ì´','ìƒˆ ì‹œì‘Â·ìˆœìˆ˜Â·ì‘ìŒ','positive'],
  [14,'Fox','ì—¬ìš°','ì£¼ì˜Â·ì¼Â·ê³„ì‚°','neutral'],
  [15,'Bear','ê³°','í˜Â·ì¬ì •Â·ë³´í˜¸','positive'],
  [16,'Stars','ë³„','ì˜ê°Â·ì˜¨ë¼ì¸Â·í¬ë§','positive'],
  [17,'Stork','í™©ìƒˆ','ì´ë™Â·ê°œì„ Â·ì—…ê·¸ë ˆì´ë“œ','positive'],
  [18,'Dog','ê°œ','ì‹ ë¢°Â·ìš°ì •Â·íŒŒíŠ¸ë„ˆ','positive'],
  [19,'Tower','íƒ‘','ì œë„Â·ê±°ë¦¬Â·ê²©ì‹','neutral'],
  [20,'Garden','ì •ì›','ëª¨ì„Â·ê³µê°œÂ·í‰íŒ','neutral'],
  [21,'Mountain','ì‚°','ì§€ì—°Â·ì¥ì• Â·ë²½','negative'],
  [22,'Crossroad','ê°ˆë¦¼ê¸¸','ì„ íƒÂ·ê²°ì •Â·ë¶„ê¸°','neutral'],
  [23,'Mice','ì¥','ì†Œëª¨Â·ë¶ˆì•ˆÂ·ê°ì†Œ','negative'],
  [24,'Heart','í•˜íŠ¸','ì‚¬ë‘Â·ì—´ì •Â·í˜¸ê°','positive'],
  [25,'Ring','ë°˜ì§€','ê³„ì•½Â·ìˆœí™˜Â·ì¥ê¸°ì»¤ë°‹','positive'],
  [26,'Book','ì±…','ì§€ì‹Â·ë¹„ê³µê°œÂ·í•™ìŠµ','neutral'],
  [27,'Letter','í¸ì§€','ë¬¸ì„œÂ·ë©”ì‹œì§€Â·ì¦ë¹™','neutral'],
  [28,'Man','ë‚¨ì„±','í•µì‹¬ ì¸ë¬¼â€”ì¤‘ì‹¬ ë‚¨ì„±','neutral'],
  [29,'Woman','ì—¬ì„±','í•µì‹¬ ì¸ë¬¼â€”ì¤‘ì‹¬ ì—¬ì„±','neutral'],
  [30,'Lily','ë°±í•©','í‰í™”Â·ì„±ìˆ™Â·íœ´ì‹','positive'],
  [31,'Sun','íƒœì–‘','ì„±ê³µÂ·ê°€ì‹œí™”Â·í™œë ¥','positive'],
  [32,'Moon','ë‹¬','ê°ì •Â·ëª…ì˜ˆÂ·ë¦¬ë“¬','neutral'],
  [33,'Key','ì—´ì‡ ','í•´ê²°Â·ì •ë‹µÂ·ëŒíŒŒêµ¬','positive'],
  [34,'Fish','ë¬¼ê³ ê¸°','ì¬ë¬¼Â·êµë¥˜Â·ê±°ë˜','neutral'],
  [35,'Anchor','ë‹»','ì•ˆì •Â·ê³ ì •Â·ì§€ì†ì„±','positive'],
  [36,'Cross','ì‹­ìê°€','ê³ ë‚œÂ·ì‹ ë…Â·ì±…ì„','negative'],
];
const byNum = new Map(CARDS.map(([n,code,kr,key,type])=>[n,{n,code,kr,key,type}]));
const src = n => `images/ë ˆë…¸ë¨¼ë“œ-${String(n).padStart(2,'0')}.png`;

const result = document.getElementById('result');
const summary = document.getElementById('summary');
const all = document.getElementById('all');
const qBox = document.getElementById('questionBox');
const qInput = document.getElementById('qInput');
const toggleQ = document.getElementById('toggleQ');

toggleQ.addEventListener('change',()=>{
  qInput.style.display = toggleQ.checked ? '' : 'none';
  if(!toggleQ.checked){ qInput.value=''; qBox.style.display='none'; qBox.textContent=''; }
});

// ------------------ ìœ í‹¸ ------------------
function toneChip(type){
  const cls = type==='positive'?'t-good':(type==='negative'?'t-bad':'t-mid');
  const emoji = type==='positive'?'ğŸ”µ':(type==='negative'?'ğŸ”´':'ğŸŸ¢');
  const text = type==='positive'?'ê¸ì •':(type==='negative'?'ë¶€ì •':'ì¤‘ë¦½');
  return `<span class="tone ${cls}">${emoji} ${text}</span>`;
}
function pinClass(type){ return type==='positive'?'good':(type==='negative'?'bad':'mid'); }
function ensureQuestionShown(){
  if(toggleQ.checked && qInput.value.trim()){
    qBox.style.display='block';
    qBox.innerHTML = `<b>ì§ˆë¬¸:</b> ${qInput.value.trim()}`;
  }else{
    qBox.style.display='none'; qBox.textContent='';
  }
}
// ë¬´ì‘ìœ„ Nì¥
function pickN(n){ const arr=[...byNum.values()]; for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];} return arr.slice(0,n); }

// í•œ ì¥ ë Œë”
function renderCard(c,extraCls=''){
  return `
  <article class="card-mini ${extraCls}">
    <span class="pin ${pinClass(c.type)}"></span>
    <div class="img"><img src="${src(c.n)}" alt=""></div>
    <h4><b>${c.n}. ${c.code}</b> (${c.kr})</h4>
    <p>${c.key}</p>
    ${toneChip(c.type)}
  </article>`;
}

// ê°€ë¡œ Nì¥(3,5) â€” í•œ í™”ë©´ ìë™ ì¶•ì†Œ
function renderRow(cards,cols){
  result.innerHTML = `
    <div class="fitbox"><div class="fitstage" id="rowStage" style="width:${cols*240}px">
      <div class="${cols===3?'row-3':'row-5'}" style="width:${cols*240}px">
        ${cards.map(c=>renderCard(c)).join('')}
      </div>
    </div></div>`;
  fitToBox(document.querySelector('.fitbox'), document.getElementById('rowStage'), .98);
}
// ì‹­ì â€” ìƒ/ì¢Œ/ì¤‘ì•™/ìš°/í•˜ (ë°•ìŠ¤ ì•ˆì—ì„œ ìë™ ì¶•ì†Œ)
function renderCross(cards){
  // ìˆœì„œ: ì¤‘ì•™, ìƒ, í•˜, ì¢Œ, ìš° â†’ í™”ë©´ ë°°ì¹˜ëŠ” ìƒ/ì¢Œ/ì¤‘ì•™/ìš°/í•˜
  const [C,Up,Down,Left,Right]=cards;
  const html = `
  <div class="fitbox"><div class="fitstage" id="crossStage">
    <div style="display:grid;grid-template-columns:repeat(3,240px);grid-template-rows:repeat(3,auto);gap:12px;align-items:center;justify-items:center">
      <div></div>           <div style="width:240px">${renderCard(Up)}</div>    <div></div>
      <div style="width:240px">${renderCard(Left)}</div> <div style="width:240px">${renderCard(C)}</div> <div style="width:240px">${renderCard(Right)}</div>
      <div></div>           <div style="width:240px">${renderCard(Down)}</div>  <div></div>
    </div>
  </div></div>`;
  result.innerHTML=html;
  fitToBox(document.querySelector('.fitbox'), document.getElementById('crossStage'), .98);
}

// --------- ê·¸ë‘íƒ€ë¸”ë¡œ (ëª¨ë°”ì¼ í•œ í™”ë©´ ìë™ ì¶•ì†Œ ìœ ì§€) ----------
function grandTableau(cols, rows, withEssence){
  ensureQuestionShown();
  const order = pickN(36).map(c=>c.n);
  const mainNums = order.slice(0, cols*rows);
  const essNums  = withEssence ? order.slice(cols*rows) : [];

  const mainGrid = `
    <div class="gt-toolbar">ì¹´ë“œë¥¼ ëˆ„ë¥´ë©´ í‚¤ì¹´ë“œì˜ ì£¼ìœ„ ì¹´ë“œì™€ ë‚˜ì´íŒ…(ê¸°ì‚¬)ì´ ì˜¤ë¥¸ìª½ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
    <div class="fitbox" id="gtMainBox">
      <div class="fitstage" id="gtStage">
        <div class="gt-grid" style="grid-template-columns:repeat(${cols},var(--card-w));gap:8px">
          ${mainNums.map((n,i)=>{
            const c=byNum.get(n);
            return `
            <div class="card-mini gt" data-idx="${i}" data-num="${n}" style="width:var(--card-w)">
              <span class="pin ${pinClass(c.type)}"></span>
              <div class="img"><img src="${src(n)}" alt=""></div>
              <h4><b>${c.n}. ${c.code}</b> (${c.kr})</h4>
              <p>${c.key}</p>
              ${toneChip(c.type)}
            </div>`;
          }).join('')}
        </div>
      </div>
    </div>`;

  const essGrid = withEssence ? `
    <div class="gt-toolbar"><b>ì—ì„¼ìŠ¤ 4ì¥</b></div>
    <div class="fitbox" id="gtEssBox">
      <div class="fitstage" id="gtEss">
        <div class="gt-grid" style="grid-template-columns:repeat(4,var(--card-w));gap:8px">
          ${essNums.map(n=>{
            const c=byNum.get(n);
            return `
            <div class="card-mini" style="width:var(--card-w)">
              <span class="pin ${pinClass(c.type)}"></span>
              <div class="img"><img src="${src(n)}" alt=""></div>
              <h4><b>${c.n}. ${c.code}</b> (${c.kr})</h4>
              <p>${c.key}</p>
              ${toneChip(c.type)}
            </div>`;
          }).join('')}
        </div>
      </div>
    </div>
    ${renderEssSummary(essNums)}
  ` : '';

  result.innerHTML = `
    <div class="gt-wrap">
      <div>${mainGrid}${essGrid}</div>
      <div id="gtInfo" class="sidepanel">í‚¤ ì¹´ë“œë¥¼ ì„ íƒí•˜ë©´ í•´ì„ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
    </div>`;
  summary.innerHTML='';

  // í‚¤ì¹´ë“œ í´ë¦­ â†’ ì£¼ìœ„/ë‚˜ì´íŒ…
  const gridEl = document.querySelector('#gtStage .gt-grid');
  const toIdx=(r,c)=> (r>=0&&r<rows&&c>=0&&c<cols)? r*cols+c : -1;
  gridEl.querySelectorAll('.gt').forEach(el=>{
    el.addEventListener('click',()=>{
      const idx=+el.dataset.idx, r=Math.floor(idx/cols), c=idx%cols;
      const around=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]]
        .map(([dr,dc])=>toIdx(r+dr,c+dc)).filter(i=>i>=0);
      const knight=[[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]]
        .map(([dr,dc])=>toIdx(r+dr,c+dc)).filter(i=>i>=0);
      const getNum=i=>+gridEl.querySelector(`.gt[data-idx="${i}"]`).dataset.num;
      const listFmt = arr => arr.map(n=>`${n}. ${byNum.get(n).code}`).join(', ') || 'ì—†ìŒ';
      const me = byNum.get(+el.dataset.num);
      document.getElementById('gtInfo').innerHTML =
        `<b>í‚¤ ì¹´ë“œ:</b> ${me.n}. ${me.code} (${me.kr}) â€” ${me.key}<br>
         <b>ì£¼ìœ„ ì¹´ë“œ:</b> ${listFmt(around.map(getNum))}<br>
         <b>ë‚˜ì´íŒ…:</b> ${listFmt(knight.map(getNum))}`;
    },{passive:true});
  });

  // í•œ í™”ë©´ ìë™ ì¶•ì†Œ(ë©”ì¸/ì—ì„¼ìŠ¤ ê°ê°)
  const fitMain = ()=>fitToBox(document.getElementById('gtMainBox'), document.getElementById('gtStage'), .97);
  const fitEss  = ()=>withEssence && fitToBox(document.getElementById('gtEssBox'),  document.getElementById('gtEss'),  .97);

  const imgs=[...document.querySelectorAll('#gtStage img')];
  if(withEssence) imgs.push(...document.querySelectorAll('#gtEss img'));
  Promise.all(imgs.map(im=> im.complete?true:new Promise(res=>{im.addEventListener('load',res,{once:true});im.addEventListener('error',res,{once:true});})))
    .then(()=>{ fitMain(); fitEss(); requestAnimationFrame(()=>{fitMain();fitEss();}); setTimeout(()=>{fitMain();fitEss();},120); });
  addEventListener('resize',()=>{fitMain();fitEss();},{passive:true});
  window.visualViewport?.addEventListener('resize',()=>{fitMain();fitEss();},{passive:true});
}
function renderEssSummary(essNums){
  if(!essNums.length) return '';
  const cards = essNums.map(n=>byNum.get(n));
  const cnt={ê¸ì •:0,ë¶€ì •:0,ì¤‘ë¦½:0};
  const t=v=>v==='positive'?'ê¸ì •':v==='negative'?'ë¶€ì •':'ì¤‘ë¦½';
  cards.forEach(c=>cnt[t(c.type)]++);
  const lead = Object.entries(cnt).sort((a,b)=>b[1]-a[1])[0][0];
  const emoji = lead==='ê¸ì •'?'ğŸ”µ':lead==='ë¶€ì •'?'ğŸ”´':'ğŸŸ¢';
  const advice = lead==='ê¸ì •'
    ? 'í•µì‹¬ ì—ë„ˆì§€ê°€ ìš°í˜¸ì ì…ë‹ˆë‹¤. ê²°ì •ì„ ì§„í–‰í•˜ê³ , ì—°ë½/í™ë³´ë¥¼ í™•ëŒ€í•´ë„ ì¢‹ì•„ìš”.'
    : lead==='ë¶€ì •'
      ? 'í•µì‹¬ ë¦¬ìŠ¤í¬ê°€ ë‚¨ì•˜ìŠµë‹ˆë‹¤. ë¬¸ì„œÂ·ë°ì´í„°Â·ì¼ì •ì—ì„œ ì·¨ì•½ ì§€ì ì„ ë¨¼ì € ë³´ì™„í•˜ì„¸ìš”.'
      : 'í˜¼í•© ì—ë„ˆì§€ì…ë‹ˆë‹¤. ê´€ì¸¡ ê¸°ê°„ì„ ë‘ê³  ì‹¤í—˜/ëŒ€ì•ˆì„ ë³‘í–‰í•˜ì„¸ìš”.';
  return `
    <div class="sumbox">
      <div class="sum-title">ì—ì„¼ìŠ¤ í†¤: ${emoji} <b>${lead}</b>
        <span class="sum-note"> (ê¸ì • ${cnt.ê¸ì •} / ë¶€ì • ${cnt.ë¶€ì •} / ì¤‘ë¦½ ${cnt.ì¤‘ë¦½})</span>
      </div>
      <ul class="sum-list">${cards.map(c=>`<li>${c.n}. ${c.code} â€” ${c.key}</li>`).join('')}</ul>
      <div class="sum-advice"><b>ê¶Œê³ :</b> ${advice}</div>
    </div>`;
}

// --------- ì´í‰(5ì¹´ë“œ) ----------
function summarizeFive(cards){
  const cnt={ê¸ì •:0,ë¶€ì •:0,ì¤‘ë¦½:0};
  const mapTone=t=>t==='positive'?'ê¸ì •':t==='negative'?'ë¶€ì •':'ì¤‘ë¦½';
  cards.forEach(c=>cnt[mapTone(c.type)]++);
  const lead=Object.entries(cnt).sort((a,b)=>b[1]-a[1])[0][0];
  const emoji=lead==='ê¸ì •'?'ğŸ”µ':lead==='ë¶€ì •'?'ğŸ”´':'ğŸŸ¢';
  const bullets = cards.map(c=>`<li>${c.n}. ${c.code} â€” ${c.key}</li>`).join('');
  const advice = lead==='ê¸ì •'
    ? 'ìš°í˜¸ì  íë¦„ì…ë‹ˆë‹¤. ë“¤ì–´ì˜¨ ì œì•ˆ/ì—°ë½ì„ í™œìš©í•˜ê³  ì†ë„ë¥¼ ì‚´ë ¤ ë³´ì„¸ìš”.'
    : lead==='ë¶€ì •'
      ? 'ë¦¬ìŠ¤í¬ ê´€ë¦¬ ìš°ì„ . ì¼ì •Â·ìì›Â·ë¬¸ì„œ(ê³„ì•½) ì²´í¬ í›„ ì†ë„ë¥¼ ì¡°ì ˆí•˜ì„¸ìš”.'
      : 'ë³€ìˆ˜ê°€ ìˆìŠµë‹ˆë‹¤. ì •ë³´ ë³´ê°•ê³¼ ì¼ì • ì¡°ì •ìœ¼ë¡œ ê· í˜•ì„ ë§ì¶”ì„¸ìš”.';
  summary.innerHTML = `
    <div class="sumbox">
      <div class="sum-title">ì „ì²´ í†¤: ${emoji} <b>${lead}</b>
        <span class="sum-note"> (ê¸ì • ${cnt.ê¸ì •} / ë¶€ì • ${cnt.ë¶€ì •} / ì¤‘ë¦½ ${cnt.ì¤‘ë¦½})</span>
      </div>
      <ul class="sum-list">${bullets}</ul>
      <div class="sum-advice"><b>ê¶Œê³ :</b> ${advice}</div>
    </div>`;
}

// ------------- ì¹´ë“œ ì „ì²´ ë³´ê¸° -------------
function renderAll(){
  all.style.display = all.style.display==='none' ? 'grid':'none';
  if(all.dataset.filled==='1') return;
  all.innerHTML = CARDS.map(([n,code,kr,key,type])=>{
    const c={n,code,kr,key,type};
    return renderCard(c);
  }).join('');
  all.dataset.filled='1';
}

// ------------- í•œ í™”ë©´ ìë™ ì¶•ì†Œ ê³µí†µ -------------
function fitToBox(box, stage, pad=0.98){
  if(!box||!stage) return;
  const bw = box.clientWidth, bh = (box.clientHeight||window.innerHeight*0.68);
  const sw = stage.scrollWidth, sh = stage.scrollHeight;
  const scale = Math.min((bw/sw)*pad, (bh/sh)*pad, 1);
  stage.style.transform = `scale(${scale})`;
}

// ------------- ë²„íŠ¼ ë™ì‘ -------------
document.getElementById('btn1').addEventListener('click',()=>{
  ensureQuestionShown();
  const cards = pickN(1);
  summary.innerHTML='';
  renderRow(cards,3); // 1ì¹¸ì´ì–´ë„ 3ì¹¸ ë ˆì¼ì— ê°€ìš´ë° ì •ë ¬
});
document.getElementById('btn3').addEventListener('click',()=>{
  ensureQuestionShown();
  const cards = pickN(3);
  summary.innerHTML='';
  renderRow(cards,3);
});
document.getElementById('btn5').addEventListener('click',()=>{
  ensureQuestionShown();
  const cards = pickN(5);
  renderRow(cards,5);
  summarizeFive(cards);
});
document.getElementById('btnCross').addEventListener('click',()=>{
  ensureQuestionShown();
  const cards = pickN(5);
  summary.innerHTML='';
  // ìˆœì„œ êµ¬ì„±: ì¤‘ì•™, ìƒ, í•˜, ì¢Œ, ìš°
  renderCross([cards[2],cards[0],cards[4],cards[1],cards[3]]);
});
document.getElementById('btnGT94').addEventListener('click',()=> grandTableau(9,4,false));
document.getElementById('btnGT84').addEventListener('click',()=> grandTableau(8,4,true));
document.getElementById('btnAll').addEventListener('click',renderAll);

// ì´ˆê¸°: ì•„ë¬´ ì¹´ë“œë„ ìë™ í‘œì‹œí•˜ì§€ ì•ŠìŒ
result.innerHTML = '';
summary.innerHTML = '';
</script>
</body>
</html>